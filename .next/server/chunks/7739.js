"use strict";exports.id=7739,exports.ids=[7739],exports.modules={14230:(a,b,c)=>{let d=c(28706),e=c(33675),f=c(29294),g=c(63033),h=c(26906),i=c(11938),j=c(82831),k=c(30787),l=c(31716),m=c(49290);c(63036);new WeakMap;(0,k.createDedupedByCallsiteServerErrorLoggerDev)(function(a,b){let c=a?`Route "${a}" `:"This route ";return Object.defineProperty(Error(`${c}used ${b}. \`cookies()\` should be awaited before using its value. Learn more: https://nextjs.org/docs/messages/sync-dynamic-apis`),"__NEXT_ERROR_CODE",{value:"E223",enumerable:!1,configurable:!0})})},28706:(a,b,c)=>{Object.defineProperty(b,"__esModule",{value:!0}),!function(a,b){for(var c in b)Object.defineProperty(a,c,{enumerable:!0,get:b[c]})}(b,{MutableRequestCookiesAdapter:function(){return l},ReadonlyRequestCookiesError:function(){return g},RequestCookiesAdapter:function(){return h},appendMutableCookies:function(){return k},areCookiesMutableInCurrentPhase:function(){return n},createCookiesWithMutableAccessCheck:function(){return m},getModifiedCookieValues:function(){return j},responseCookiesToRequestCookies:function(){return p}});let d=c(33675),e=c(63036),f=c(29294);class g extends Error{constructor(){super("Cookies can only be modified in a Server Action or Route Handler. Read more: https://nextjs.org/docs/app/api-reference/functions/cookies#options")}static callable(){throw new g}}class h{static seal(a){return new Proxy(a,{get(a,b,c){switch(b){case"clear":case"delete":case"set":return g.callable;default:return e.ReflectAdapter.get(a,b,c)}}})}}let i=Symbol.for("next.mutated.cookies");function j(a){let b=a[i];return b&&Array.isArray(b)&&0!==b.length?b:[]}function k(a,b){let c=j(b);if(0===c.length)return!1;let e=new d.ResponseCookies(a),f=e.getAll();for(let a of c)e.set(a);for(let a of f)e.set(a);return!0}class l{static wrap(a,b){let c=new d.ResponseCookies(new Headers);for(let b of a.getAll())c.set(b);let g=[],h=new Set,j=()=>{let a=f.workAsyncStorage.getStore();if(a&&(a.pathWasRevalidated=!0),g=c.getAll().filter(a=>h.has(a.name)),b){let a=[];for(let b of g){let c=new d.ResponseCookies(new Headers);c.set(b),a.push(c.toString())}b(a)}},k=new Proxy(c,{get(a,b,c){switch(b){case i:return g;case"delete":return function(...b){h.add("string"==typeof b[0]?b[0]:b[0].name);try{return a.delete(...b),k}finally{j()}};case"set":return function(...b){h.add("string"==typeof b[0]?b[0]:b[0].name);try{return a.set(...b),k}finally{j()}};default:return e.ReflectAdapter.get(a,b,c)}}});return k}}function m(a){let b=new Proxy(a.mutableCookies,{get(c,d,f){switch(d){case"delete":return function(...d){return o(a,"cookies().delete"),c.delete(...d),b};case"set":return function(...d){return o(a,"cookies().set"),c.set(...d),b};default:return e.ReflectAdapter.get(c,d,f)}}});return b}function n(a){return"action"===a.phase}function o(a,b){if(!n(a))throw new g}function p(a){let b=new d.RequestCookies(new Headers);for(let c of a.getAll())b.set(c);return b}},30787:(a,b,c)=>{Object.defineProperty(b,"__esModule",{value:!0}),Object.defineProperty(b,"createDedupedByCallsiteServerErrorLoggerDev",{enumerable:!0,get:function(){return i}});let d=function(a,b){if(a&&a.__esModule)return a;if(null===a||"object"!=typeof a&&"function"!=typeof a)return{default:a};var c=e(b);if(c&&c.has(a))return c.get(a);var d={__proto__:null},f=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var g in a)if("default"!==g&&Object.prototype.hasOwnProperty.call(a,g)){var h=f?Object.getOwnPropertyDescriptor(a,g):null;h&&(h.get||h.set)?Object.defineProperty(d,g,h):d[g]=a[g]}return d.default=a,c&&c.set(a,d),d}(c(74515));function e(a){if("function"!=typeof WeakMap)return null;var b=new WeakMap,c=new WeakMap;return(e=function(a){return a?c:b})(a)}let f={current:null},g="function"==typeof d.cache?d.cache:a=>a,h=console.warn;function i(a){return function(...b){h(a(...b))}}g(a=>{try{h(f.current)}finally{f.current=null}})},34198:(a,b,c)=>{let d,e,f,g;c.d(b,{f2:()=>aC});var h=c(33873);function i(a){return a.replace(/^[A-Z]:/,"").replace(/\\/g,"/")}let j=a=>void 0===a?void 0:a.variant??a.enabled,k=a=>{if("string"!=typeof a)return a;try{return JSON.parse(a)}catch{return a}},l="0123456789abcdef";class m{constructor(a){this.bytes=a}static ofInner(a){if(16===a.length)return new m(a);throw TypeError("not 128-bit length")}static fromFieldsV7(a,b,c,d){if(!Number.isInteger(a)||!Number.isInteger(b)||!Number.isInteger(c)||!Number.isInteger(d)||a<0||b<0||c<0||d<0||a>0xffffffffffff||b>4095||c>0x3fffffff||d>0xffffffff)throw RangeError("invalid field value");let e=new Uint8Array(16);return e[0]=a/0x10000000000,e[1]=a/0x100000000,e[2]=a/0x1000000,e[3]=a/65536,e[4]=a/256,e[5]=a,e[6]=112|b>>>8,e[7]=b,e[8]=128|c>>>24,e[9]=c>>>16,e[10]=c>>>8,e[11]=c,e[12]=d>>>24,e[13]=d>>>16,e[14]=d>>>8,e[15]=d,new m(e)}static parse(a){let b;switch(a.length){case 32:b=/^[0-9a-f]{32}$/i.exec(a)?.[0];break;case 36:b=/^([0-9a-f]{8})-([0-9a-f]{4})-([0-9a-f]{4})-([0-9a-f]{4})-([0-9a-f]{12})$/i.exec(a)?.slice(1,6).join("");break;case 38:b=/^\{([0-9a-f]{8})-([0-9a-f]{4})-([0-9a-f]{4})-([0-9a-f]{4})-([0-9a-f]{12})\}$/i.exec(a)?.slice(1,6).join("");break;case 45:b=/^urn:uuid:([0-9a-f]{8})-([0-9a-f]{4})-([0-9a-f]{4})-([0-9a-f]{4})-([0-9a-f]{12})$/i.exec(a)?.slice(1,6).join("")}if(b){let a=new Uint8Array(16);for(let c=0;c<16;c+=4){let d=parseInt(b.substring(2*c,2*c+8),16);a[c+0]=d>>>24,a[c+1]=d>>>16,a[c+2]=d>>>8,a[c+3]=d}return new m(a)}throw SyntaxError("could not parse UUID string")}toString(){let a="";for(let b=0;b<this.bytes.length;b++)a+=l.charAt(this.bytes[b]>>>4),a+=l.charAt(15&this.bytes[b]),(3===b||5===b||7===b||9===b)&&(a+="-");return a}toHex(){let a="";for(let b=0;b<this.bytes.length;b++)a+=l.charAt(this.bytes[b]>>>4),a+=l.charAt(15&this.bytes[b]);return a}toJSON(){return this.toString()}getVariant(){let a=this.bytes[8]>>>4;if(a<0)throw Error("unreachable");if(a<=7)return this.bytes.every(a=>0===a)?"NIL":"VAR_0";if(a<=11)return"VAR_10";if(a<=13)return"VAR_110";if(a<=15)return this.bytes.every(a=>255===a)?"MAX":"VAR_RESERVED";throw Error("unreachable")}getVersion(){return"VAR_10"===this.getVariant()?this.bytes[6]>>>4:void 0}clone(){return new m(this.bytes.slice(0))}equals(a){return 0===this.compareTo(a)}compareTo(a){for(let b=0;b<16;b++){let c=this.bytes[b]-a.bytes[b];if(0!==c)return Math.sign(c)}return 0}}class n{constructor(a){this.timestamp=0,this.counter=0,this.random=a??o()}generate(){return this.generateOrResetCore(Date.now(),1e4)}generateOrAbort(){return this.generateOrAbortCore(Date.now(),1e4)}generateOrResetCore(a,b){let c=this.generateOrAbortCore(a,b);return void 0===c&&(this.timestamp=0,c=this.generateOrAbortCore(a,b)),c}generateOrAbortCore(a,b){if(!Number.isInteger(a)||a<1||a>0xffffffffffff)throw RangeError("`unixTsMs` must be a 48-bit positive integer");if(b<0||b>0xffffffffffff)throw RangeError("`rollbackAllowance` out of reasonable range");if(a>this.timestamp)this.timestamp=a,this.resetCounter();else{if(!(a+b>=this.timestamp))return;this.counter++,this.counter>0x3ffffffffff&&(this.timestamp++,this.resetCounter())}return m.fromFieldsV7(this.timestamp,Math.trunc(this.counter/0x40000000),this.counter&0x40000000-1,this.random.nextUint32())}resetCounter(){this.counter=1024*this.random.nextUint32()+(1023&this.random.nextUint32())}generateV4(){let a=new Uint8Array(Uint32Array.of(this.random.nextUint32(),this.random.nextUint32(),this.random.nextUint32(),this.random.nextUint32()).buffer);return a[6]=64|a[6]>>>4,a[8]=128|a[8]>>>2,m.ofInner(a)}}let o=()=>({nextUint32:()=>65536*Math.trunc(65536*Math.random())+Math.trunc(65536*Math.random())}),p=()=>q().toString(),q=()=>(d||(d=new n)).generate();var r=function(a){return a.AnonymousId="anonymous_id",a.DistinctId="distinct_id",a.Props="props",a.FeatureFlagDetails="feature_flag_details",a.FeatureFlags="feature_flags",a.FeatureFlagPayloads="feature_flag_payloads",a.BootstrapFeatureFlagDetails="bootstrap_feature_flag_details",a.BootstrapFeatureFlags="bootstrap_feature_flags",a.BootstrapFeatureFlagPayloads="bootstrap_feature_flag_payloads",a.OverrideFeatureFlags="override_feature_flags",a.Queue="queue",a.OptedOut="opted_out",a.SessionId="session_id",a.SessionStartTimestamp="session_start_timestamp",a.SessionLastTimestamp="session_timestamp",a.PersonProperties="person_properties",a.GroupProperties="group_properties",a.InstalledAppBuild="installed_app_build",a.InstalledAppVersion="installed_app_version",a.SessionReplay="session_replay",a.SurveyLastSeenDate="survey_last_seen_date",a.SurveysSeen="surveys_seen",a.Surveys="surveys",a.RemoteConfig="remote_config",a.FlagsEndpointWasHit="flags_endpoint_was_hit",a}({});let s=Array.isArray,t=Object.prototype;t.hasOwnProperty;let u=t.toString,v=s||function(a){return"[object Array]"===u.call(a)},w=a=>"[object String]"==u.call(a);function x(a){return void 0!==Event&&function(a,b){try{return a instanceof b}catch{return!1}}(a,Event)}function y(a,b,c,d,e){if(b>c&&(d.warn("min cannot be greater than max."),b=c),"[object Number]"==u.call(a))if(a>c)return d.warn(" cannot be  greater than max: "+c+". Using max value instead."),c;else return a<b?(d.warn(" cannot be less than min: "+b+". Using min value instead."),b):a;return d.warn(" must be a number. using max or fallback. max: "+c+", fallback: "+e),y(e||c,b,c,d)}class z{constructor(a){this._options=a,this._buckets={},this._refillBuckets=()=>{Object.keys(this._buckets).forEach(a=>{let b=this._getBucket(a)+this._refillRate;b>=this._bucketSize?delete this._buckets[a]:this._setBucket(a,b)})},this._getBucket=a=>this._buckets[String(a)],this._setBucket=(a,b)=>{this._buckets[String(a)]=b},this.consumeRateLimit=a=>{let b=this._getBucket(a)??this._bucketSize;if(0===(b=Math.max(b-1,0)))return!0;this._setBucket(a,b);let c=0===b;return c&&this._onBucketRateLimited?.(a),c},this._onBucketRateLimited=this._options._onBucketRateLimited,this._bucketSize=y(this._options.bucketSize,0,100,this._options._logger),this._refillRate=y(this._options.refillRate,0,this._bucketSize,this._options._logger),this._refillInterval=y(this._options.refillInterval,0,864e5,this._options._logger),this._removeInterval=setInterval(()=>{this._refillBuckets()},this._refillInterval)}stop(){this._removeInterval&&(clearInterval(this._removeInterval),this._removeInterval=void 0)}}class A{add(a){let b=p();return this.promiseByIds[b]=a,a.catch(()=>{}).finally(()=>{delete this.promiseByIds[b]}),a}async join(){let a=Object.values(this.promiseByIds),b=a.length;for(;b>0;)await Promise.all(a),b=(a=Object.values(this.promiseByIds)).length}get length(){return Object.keys(this.promiseByIds).length}constructor(){this.promiseByIds={}}}async function B(a,b){let c=null;for(let d=0;d<b.retryCount+1;d++){d>0&&await new Promise(a=>setTimeout(a,b.retryDelay));try{return await a()}catch(a){if(c=a,!b.retryCheck(a))throw a}}throw c}function C(){return new Date().toISOString()}function D(a,b){let c=setTimeout(a,b);return c?.unref&&c?.unref(),c}let E=a=>a instanceof Error;function F(a){return Promise.all(a.map(a=>(a??Promise.resolve()).then(a=>({status:"fulfilled",value:a}),a=>({status:"rejected",reason:a}))))}class G{constructor(){this.events={},this.events={}}on(a,b){return this.events[a]||(this.events[a]=[]),this.events[a].push(b),()=>{this.events[a]=this.events[a].filter(a=>a!==b)}}emit(a,b){for(let c of this.events[a]||[])c(b);for(let c of this.events["*"]||[])c(a,b)}}async function H(a,b=!0){try{let b=new Blob([a],{type:"text/plain"}).stream().pipeThrough(new CompressionStream("gzip"));return await new Response(b).blob()}catch(a){return b&&console.error("Failed to gzip compress data",a),null}}class I extends Error{constructor(a,b){super("HTTP error while fetching PostHog: status="+a.status+", reqByteLength="+b),this.response=a,this.reqByteLength=b,this.name="PostHogFetchHttpError"}get status(){return this.response.status}get text(){return this.response.text()}get json(){return this.response.json()}}class J extends Error{constructor(a){super("Network error while fetching PostHog",a instanceof Error?{cause:a}:{}),this.error=a,this.name="PostHogFetchNetworkError"}}async function K(a){if(a instanceof I){let b="";try{b=await a.text}catch{}console.error(`Error while flushing PostHog: message=${a.message}, response body=${b}`,a)}else console.error("Error while flushing PostHog",a);return Promise.resolve()}function L(a){return"object"==typeof a&&(a instanceof I||a instanceof J)}function M(a){return"object"==typeof a&&a instanceof I&&413===a.status}class N{constructor(a,b){var c;this.flushPromise=null,this.shutdownPromise=null,this.promiseQueue=new A,this._events=new G,this._isInitialized=!1,function(a,b){if(!a||"string"!=typeof a||0===a.trim().length)throw Error(b)}(a,"You must pass your PostHog project's api key."),this.apiKey=a,this.host=(c=b?.host||"https://us.i.posthog.com",c?.replace(/\/+$/,"")),this.flushAt=b?.flushAt?Math.max(b?.flushAt,1):20,this.maxBatchSize=Math.max(this.flushAt,b?.maxBatchSize??100),this.maxQueueSize=Math.max(this.flushAt,b?.maxQueueSize??1e3),this.flushInterval=b?.flushInterval??1e4,this.preloadFeatureFlags=b?.preloadFeatureFlags??!0,this.defaultOptIn=b?.defaultOptIn??!0,this.disableSurveys=b?.disableSurveys??!1,this._retryOptions={retryCount:b?.fetchRetryCount??3,retryDelay:b?.fetchRetryDelay??3e3,retryCheck:L},this.requestTimeout=b?.requestTimeout??1e4,this.featureFlagsRequestTimeoutMs=b?.featureFlagsRequestTimeoutMs??3e3,this.remoteConfigRequestTimeoutMs=b?.remoteConfigRequestTimeoutMs??3e3,this.disableGeoip=b?.disableGeoip??!0,this.disabled=b?.disabled??!1,this.historicalMigration=b?.historicalMigration??!1,this._initPromise=Promise.resolve(),this._isInitialized=!0,this.disableCompression=!("CompressionStream"in globalThis)||(b?.disableCompression??!1)}logMsgIfDebug(a){this.isDebug&&a()}wrap(a){return this.disabled?void this.logMsgIfDebug(()=>console.warn("[PostHog] The client is disabled")):this._isInitialized?a():void this._initPromise.then(()=>a())}getCommonEventProperties(){return{$lib:this.getLibraryId(),$lib_version:this.getLibraryVersion()}}get optedOut(){return this.getPersistedProperty(r.OptedOut)??!this.defaultOptIn}async optIn(){this.wrap(()=>{this.setPersistedProperty(r.OptedOut,!1)})}async optOut(){this.wrap(()=>{this.setPersistedProperty(r.OptedOut,!0)})}on(a,b){return this._events.on(a,b)}debug(a=!0){if(this.removeDebugCallback?.(),a){let a=this.on("*",(a,b)=>console.log("PostHog Debug",a,b));this.removeDebugCallback=()=>{a(),this.removeDebugCallback=void 0}}}get isDebug(){return!!this.removeDebugCallback}get isDisabled(){return this.disabled}buildPayload(a){return{distinct_id:a.distinct_id,event:a.event,properties:{...a.properties||{},...this.getCommonEventProperties()}}}addPendingPromise(a){return this.promiseQueue.add(a)}identifyStateless(a,b,c){this.wrap(()=>{let d={...this.buildPayload({distinct_id:a,event:"$identify",properties:b})};this.enqueue("identify",d,c)})}async identifyStatelessImmediate(a,b,c){let d={...this.buildPayload({distinct_id:a,event:"$identify",properties:b})};await this.sendImmediate("identify",d,c)}captureStateless(a,b,c,d){this.wrap(()=>{let e=this.buildPayload({distinct_id:a,event:b,properties:c});this.enqueue("capture",e,d)})}async captureStatelessImmediate(a,b,c,d){let e=this.buildPayload({distinct_id:a,event:b,properties:c});await this.sendImmediate("capture",e,d)}aliasStateless(a,b,c,d){this.wrap(()=>{let e=this.buildPayload({event:"$create_alias",distinct_id:b,properties:{...c||{},distinct_id:b,alias:a}});this.enqueue("alias",e,d)})}async aliasStatelessImmediate(a,b,c,d){let e=this.buildPayload({event:"$create_alias",distinct_id:b,properties:{...c||{},distinct_id:b,alias:a}});await this.sendImmediate("alias",e,d)}groupIdentifyStateless(a,b,c,d,e,f){this.wrap(()=>{let g=this.buildPayload({distinct_id:e||`$${a}_${b}`,event:"$groupidentify",properties:{$group_type:a,$group_key:b,$group_set:c||{},...f||{}}});this.enqueue("capture",g,d)})}async getRemoteConfig(){await this._initPromise;let a=this.host;"https://us.i.posthog.com"===a?a="https://us-assets.i.posthog.com":"https://eu.i.posthog.com"===a&&(a="https://eu-assets.i.posthog.com");let b=`${a}/array/${this.apiKey}/config`,c={method:"GET",headers:{...this.getCustomHeaders(),"Content-Type":"application/json"}};return this.fetchWithRetry(b,c,{retryCount:0},this.remoteConfigRequestTimeoutMs).then(a=>a.json()).catch(a=>{this.logMsgIfDebug(()=>console.error("Remote config could not be loaded",a)),this._events.emit("error",a)})}async getFlags(a,b={},c={},d={},e={}){await this._initPromise;let f=`${this.host}/flags/?v=2&config=true`,g={method:"POST",headers:{...this.getCustomHeaders(),"Content-Type":"application/json"},body:JSON.stringify({token:this.apiKey,distinct_id:a,groups:b,person_properties:c,group_properties:d,...e})};return this.logMsgIfDebug(()=>console.log("PostHog Debug","Flags URL",f)),this.fetchWithRetry(f,g,{retryCount:0},this.featureFlagsRequestTimeoutMs).then(a=>a.json()).then(a=>(a=>{if("flags"in a){let b=Object.fromEntries(Object.entries(a.flags??{}).map(([a,b])=>[a,j(b)]).filter(([,a])=>void 0!==a)),c=(a=>{let b=a??{};return Object.fromEntries(Object.keys(b).filter(a=>{let c=b[a];return c.enabled&&c.metadata&&void 0!==c.metadata.payload}).map(a=>{let c=b[a].metadata?.payload;return[a,c?k(c):void 0]}))})(a.flags);return{...a,featureFlags:b,featureFlagPayloads:c}}{let b=a.featureFlags??{},c=Object.fromEntries(Object.entries(a.featureFlagPayloads||{}).map(([a,b])=>[a,k(b)])),d=Object.fromEntries(Object.entries(b).map(([a,b])=>{var d,e;return[a,{key:a,enabled:"string"==typeof(d=b)||d,variant:"string"==typeof d?d:void 0,reason:void 0,metadata:{id:void 0,version:void 0,payload:(e=c[a])?JSON.stringify(e):void 0,description:void 0}}]}));return{...a,featureFlags:b,featureFlagPayloads:c,flags:d}}})(a)).catch(a=>{this._events.emit("error",a)})}async getFeatureFlagStateless(a,b,c={},d={},e={},f){await this._initPromise;let g=await this.getFeatureFlagDetailStateless(a,b,c,d,e,f);if(void 0===g)return{response:void 0,requestId:void 0};let h=j(g.response);return void 0===h&&(h=!1),{response:h,requestId:g.requestId}}async getFeatureFlagDetailStateless(a,b,c={},d={},e={},f){await this._initPromise;let g=await this.getFeatureFlagDetailsStateless(b,c,d,e,f,[a]);if(void 0!==g)return{response:g.flags[a],requestId:g.requestId}}async getFeatureFlagPayloadStateless(a,b,c={},d={},e={},f){await this._initPromise;let g=await this.getFeatureFlagPayloadsStateless(b,c,d,e,f,[a]);if(!g)return;let h=g[a];return void 0===h?null:h}async getFeatureFlagPayloadsStateless(a,b={},c={},d={},e,f){return await this._initPromise,(await this.getFeatureFlagsAndPayloadsStateless(a,b,c,d,e,f)).payloads}async getFeatureFlagsStateless(a,b={},c={},d={},e,f){return await this._initPromise,await this.getFeatureFlagsAndPayloadsStateless(a,b,c,d,e,f)}async getFeatureFlagsAndPayloadsStateless(a,b={},c={},d={},e,f){await this._initPromise;let g=await this.getFeatureFlagDetailsStateless(a,b,c,d,e,f);return g?{flags:g.featureFlags,payloads:g.featureFlagPayloads,requestId:g.requestId}:{flags:void 0,payloads:void 0,requestId:void 0}}async getFeatureFlagDetailsStateless(a,b={},c={},d={},e,f){await this._initPromise;let g={};(e??this.disableGeoip)&&(g.geoip_disable=!0),f&&(g.flag_keys_to_evaluate=f);let h=await this.getFlags(a,b,c,d,g);if(void 0!==h)return(h.errorsWhileComputingFlags&&console.error("[FEATURE FLAGS] Error while computing feature flags, some flags may be missing or incorrect. Learn more at https://posthog.com/docs/feature-flags/best-practices"),h.quotaLimited?.includes("feature_flags"))?(console.warn("[FEATURE FLAGS] Feature flags quota limit exceeded - feature flags unavailable. Learn more about billing limits at https://posthog.com/docs/billing/limits-alerts"),{flags:{},featureFlags:{},featureFlagPayloads:{},requestId:h?.requestId}):h}async getSurveysStateless(){if(await this._initPromise,!0===this.disableSurveys)return this.logMsgIfDebug(()=>console.log("PostHog Debug","Loading surveys is disabled.")),[];let a=`${this.host}/api/surveys/?token=${this.apiKey}`,b={method:"GET",headers:{...this.getCustomHeaders(),"Content-Type":"application/json"}},c=await this.fetchWithRetry(a,b).then(a=>{if(200!==a.status||!a.json){let b=`Surveys API could not be loaded: ${a.status}`,c=Error(b);this.logMsgIfDebug(()=>console.error(c)),this._events.emit("error",Error(b));return}return a.json()}).catch(a=>{this.logMsgIfDebug(()=>console.error("Surveys API could not be loaded",a)),this._events.emit("error",a)}),d=c?.surveys;return d&&this.logMsgIfDebug(()=>console.log("PostHog Debug","Surveys fetched from API: ",JSON.stringify(d))),d??[]}get props(){return this._props||(this._props=this.getPersistedProperty(r.Props)),this._props||{}}set props(a){this._props=a}async register(a){this.wrap(()=>{this.props={...this.props,...a},this.setPersistedProperty(r.Props,this.props)})}async unregister(a){this.wrap(()=>{delete this.props[a],this.setPersistedProperty(r.Props,this.props)})}enqueue(a,b,c){this.wrap(()=>{if(this.optedOut)return void this._events.emit(a,"Library is disabled. Not sending event. To re-enable, call posthog.optIn()");let d=this.prepareMessage(a,b,c),e=this.getPersistedProperty(r.Queue)||[];e.length>=this.maxQueueSize&&(e.shift(),this.logMsgIfDebug(()=>console.info("Queue is full, the oldest event is dropped."))),e.push({message:d}),this.setPersistedProperty(r.Queue,e),this._events.emit(a,d),e.length>=this.flushAt&&this.flushBackground(),this.flushInterval&&!this._flushTimer&&(this._flushTimer=D(()=>this.flushBackground(),this.flushInterval))})}async sendImmediate(a,b,c){if(this.disabled)return void this.logMsgIfDebug(()=>console.warn("[PostHog] The client is disabled"));if(this._isInitialized||await this._initPromise,this.optedOut)return void this._events.emit(a,"Library is disabled. Not sending event. To re-enable, call posthog.optIn()");let d={api_key:this.apiKey,batch:[this.prepareMessage(a,b,c)],sent_at:C()};this.historicalMigration&&(d.historical_migration=!0);let e=JSON.stringify(d),f=`${this.host}/batch/`,g=this.disableCompression?null:await H(e,this.isDebug),h={method:"POST",headers:{...this.getCustomHeaders(),"Content-Type":"application/json",...null!==g&&{"Content-Encoding":"gzip"}},body:g||e};try{await this.fetchWithRetry(f,h)}catch(a){this._events.emit("error",a)}}prepareMessage(a,b,c){let d={...b,type:a,library:this.getLibraryId(),library_version:this.getLibraryVersion(),timestamp:c?.timestamp?c?.timestamp:C(),uuid:c?.uuid?c.uuid:p()};return(c?.disableGeoip??this.disableGeoip)&&(d.properties||(d.properties={}),d.properties.$geoip_disable=!0),d.distinctId&&(d.distinct_id=d.distinctId,delete d.distinctId),d}clearFlushTimer(){this._flushTimer&&(clearTimeout(this._flushTimer),this._flushTimer=void 0)}flushBackground(){this.flush().catch(async a=>{await K(a)})}async flush(){let a=F([this.flushPromise]).then(()=>this._flush());return this.flushPromise=a,this.addPendingPromise(a),F([a]).then(()=>{this.flushPromise===a&&(this.flushPromise=null)}),a}getCustomHeaders(){let a=this.getCustomUserAgent(),b={};return a&&""!==a&&(b["User-Agent"]=a),b}async _flush(){this.clearFlushTimer(),await this._initPromise;let a=this.getPersistedProperty(r.Queue)||[];if(!a.length)return;let b=[],c=a.length;for(;a.length>0&&b.length<c;){let c=a.slice(0,this.maxBatchSize),d=c.map(a=>a.message),e=()=>{let b=(this.getPersistedProperty(r.Queue)||[]).slice(c.length);this.setPersistedProperty(r.Queue,b),a=b},f={api_key:this.apiKey,batch:d,sent_at:C()};this.historicalMigration&&(f.historical_migration=!0);let g=JSON.stringify(f),h=`${this.host}/batch/`,i=this.disableCompression?null:await H(g,this.isDebug),j={method:"POST",headers:{...this.getCustomHeaders(),"Content-Type":"application/json",...null!==i&&{"Content-Encoding":"gzip"}},body:i||g},k={retryCheck:a=>!M(a)&&L(a)};try{await this.fetchWithRetry(h,j,k)}catch(a){if(M(a)&&d.length>1){this.maxBatchSize=Math.max(1,Math.floor(d.length/2)),this.logMsgIfDebug(()=>console.warn(`Received 413 when sending batch of size ${d.length}, reducing batch size to ${this.maxBatchSize}`));continue}throw a instanceof J||e(),this._events.emit("error",a),a}e(),b.push(...d)}this._events.emit("flush",b)}async fetchWithRetry(a,b,c,d){AbortSignal.timeout??=function(a){let b=new AbortController;return setTimeout(()=>b.abort(),a),b.signal};let e=b.body?b.body:"",f=-1;try{f=e instanceof Blob?e.size:Buffer.byteLength(e,"utf8")}catch{f=e instanceof Blob?e.size:new TextEncoder().encode(e).length}return await B(async()=>{let c=null;try{c=await this.fetch(a,{signal:AbortSignal.timeout(d??this.requestTimeout),...b})}catch(a){throw new J(a)}if("no-cors"!==b.mode&&(c.status<200||c.status>=400))throw new I(c,f);return c},{...this._retryOptions,...c})}async _shutdown(a=3e4){await this._initPromise;let b=!1;this.clearFlushTimer();let c=async()=>{try{for(await this.promiseQueue.join();;){let a=this.getPersistedProperty(r.Queue)||[];if(0===a.length||(await this.flush(),b))break}}catch(a){if(!L(a))throw a;await K(a)}};return Promise.race([new Promise((c,d)=>{D(()=>{this.logMsgIfDebug(()=>console.error("Timed out while shutting down PostHog")),b=!0,d("Timeout while shutting down PostHog. Some events may not have been sent.")},a)}),c()])}async shutdown(a=3e4){return this.shutdownPromise?this.logMsgIfDebug(()=>console.warn("shutdown() called while already shutting down. shutdown() is meant to be called once before process exit - use flush() for per-request cleanup")):this.shutdownPromise=this._shutdown(a).finally(()=>{this.shutdownPromise=null}),this.shutdownPromise}}let O=/^\s*[-]{4,}$/,P=/at (?:async )?(?:(.+?)\s+\()?(?:(.+):(\d+):(\d+)?|([^)]+))\)?/;function Q(a){return parseInt(a||"",10)||void 0}let R=/\(error: (.*)\)/;class S{constructor(a=[],b=[],c=[]){this.coercers=a,this.modifiers=c,this.stackParser=function(...a){return(b,c=0)=>{let d=[],e=b.split("\n");for(let b=c;b<e.length;b++){let c=e[b];if(c.length>1024)continue;let f=R.test(c)?c.replace(R,"$1"):c;if(!f.match(/\S*Error: /)){for(let b of a){let a=b(f);if(a){d.push(a);break}}if(d.length>=50)break}}if(!d.length)return[];let f=Array.from(d);return f.reverse(),f.slice(0,50).map(a=>{var b;return{...a,filename:a.filename||((b=f)[b.length-1]||{}).filename,function:a.function||"?"}})}}(...b)}buildFromUnknown(a,b={}){let c=b&&b.mechanism||{handled:!0,type:"generic"},d=this.buildCoercingContext(c,b,0).apply(a),e=this.buildParsingContext(),f=this.parseStacktrace(d,e);return{$exception_list:this.convertToExceptionList(f,c),$exception_level:"error"}}async modifyFrames(a){for(let b of a)b.stacktrace&&b.stacktrace.frames&&v(b.stacktrace.frames)&&(b.stacktrace.frames=await this.applyModifiers(b.stacktrace.frames));return a}coerceFallback(a){return{type:"Error",value:"Unknown error",stack:a.syntheticException?.stack,synthetic:!0}}parseStacktrace(a,b){let c,d;return null!=a.cause&&(c=this.parseStacktrace(a.cause,b)),""!=a.stack&&null!=a.stack&&(d=this.applyChunkIds(this.stackParser(a.stack,+!!a.synthetic),b.chunkIdMap)),{...a,cause:c,stack:d}}applyChunkIds(a,b){return a.map(a=>(a.filename&&b&&(a.chunk_id=b[a.filename]),a))}applyCoercers(a,b){for(let c of this.coercers)if(c.match(a))return c.coerce(a,b);return this.coerceFallback(b)}async applyModifiers(a){let b=a;for(let a of this.modifiers)b=await a(b);return b}convertToExceptionList(a,b){let c={type:a.type,value:a.value,mechanism:{type:b.type??"generic",handled:b.handled??!0,synthetic:a.synthetic??!1}};a.stack&&(c.stacktrace={type:"raw",frames:a.stack});let d=[c];return null!=a.cause&&d.push(...this.convertToExceptionList(a.cause,{...b,handled:!0})),d}buildParsingContext(){return{chunkIdMap:function(a){let b=globalThis._posthogChunkIds;if(!b)return;let c=Object.keys(b);return g&&c.length===f?g:(f=c.length,g=c.reduce((c,d)=>{e||(e={});let f=e[d];if(f)c[f[0]]=f[1];else{let f=a(d);for(let a=f.length-1;a>=0;a--){let g=f[a],h=g?.filename,i=b[d];if(h&&i){c[h]=i,e[d]=[h,i];break}}}return c},{}))}(this.stackParser)}}buildCoercingContext(a,b,c=0){let d=(c,d)=>{if(d<=4){let e=this.buildCoercingContext(a,b,d);return this.applyCoercers(c,e)}};return{...b,syntheticException:0==c?b.syntheticException:void 0,mechanism:a,apply:a=>d(a,c),next:a=>d(a,c+1)}}}class T{match(a){return a instanceof Error}coerce(a,b){return{type:this.getType(a),value:this.getMessage(a,b),stack:this.getStack(a),cause:a.cause?b.next(a.cause):void 0,synthetic:!1}}getType(a){return a.name||a.constructor.name}getMessage(a,b){let c=a.message;return c.error&&"string"==typeof c.error.message?String(c.error.message):String(c)}getStack(a){return a.stacktrace||a.stack||void 0}}let U=/^(?:[Uu]ncaught (?:exception: )?)?(?:((?:Eval|Internal|Range|Reference|Syntax|Type|URI|)Error): )?(.*)$/i;class V{match(a){return"string"==typeof a}coerce(a,b){let[c,d]=this.getInfos(a);return{type:c??"Error",value:d??a,stack:b.syntheticException?.stack,synthetic:!0}}getInfos(a){let b="Error",c=a,d=a.match(U);return d&&(b=d[1],c=d[2]),[b,c]}}let W=["fatal","error","warning","log","info","debug"];function X(a,b=40){let c=Object.keys(a);if(c.sort(),!c.length)return"[object has no keys]";for(let a=c.length;a>0;a--){let d=c.slice(0,a).join(", ");if(!(d.length>b)){if(a===c.length)return d;return d.length<=b?d:`${d.slice(0,b)}...`}}return""}class Y{match(a){return"object"==typeof a&&null!==a}coerce(a,b){let c=this.getErrorPropertyFromObject(a);return c?b.apply(c):{type:this.getType(a),value:this.getValue(a),stack:b.syntheticException?.stack,level:this.isSeverityLevel(a.level)?a.level:"error",synthetic:!0}}getType(a){return x(a)?a.constructor.name:"Error"}getValue(a){if("name"in a&&"string"==typeof a.name){let b=`'${a.name}' captured as exception`;return"message"in a&&"string"==typeof a.message&&(b+=` with message: '${a.message}'`),b}if("message"in a&&"string"==typeof a.message)return a.message;let b=this.getObjectClassName(a),c=X(a);return`${b&&"Object"!==b?`'${b}'`:"Object"} captured as exception with keys: ${c}`}isSeverityLevel(a){return w(a)&&!(w(a)&&0===a.trim().length)&&W.indexOf(a)>=0}getErrorPropertyFromObject(a){for(let b in a)if(Object.prototype.hasOwnProperty.call(a,b)){let c=a[b];if(E(c))return c}}getObjectClassName(a){try{let b=Object.getPrototypeOf(a);return b?b.constructor.name:void 0}catch(a){return}}}class Z{match(a){return x(a)}coerce(a,b){let c=a.constructor.name;return{type:c,value:`${c} captured as exception with keys: ${X(a)}`,stack:b.syntheticException?.stack,synthetic:!0}}}class ${match(a){return null===a||"object"!=typeof a}coerce(a,b){return{type:"Error",value:`Primitive value captured as exception: ${String(a)}`,stack:b.syntheticException?.stack,synthetic:!0}}}class _{constructor(a){this._maxSize=a,this._cache=new Map}get(a){let b=this._cache.get(a);if(void 0!==b)return this._cache.delete(a),this._cache.set(a,b),b}set(a,b){this._cache.set(a,b)}reduce(){for(;this._cache.size>=this._maxSize;){let a=this._cache.keys().next().value;a&&this._cache.delete(a)}}}var aa=c(73024),ab=c(80481);let ac=new _(25),ad=new _(20);async function ae(a){let b={};for(let e=a.length-1;e>=0;e--){var c,d;let f=a[e],g=f?.filename;!(!f||"string"!=typeof g||"number"!=typeof f.lineno||(c=g).startsWith("node:")||c.endsWith(".min.js")||c.endsWith(".min.cjs")||c.endsWith(".min.mjs")||c.startsWith("data:")||void 0!==(d=f).lineno&&d.lineno>1e4||void 0!==d.colno&&d.colno>1e3)&&(b[g]||(b[g]=[]),b[g].push(f.lineno))}let e=Object.keys(b);if(0==e.length)return a;let f=[];for(let a of e){if(ad.get(a))continue;let c=b[a];if(!c)continue;c.sort((a,b)=>a-b);let d=function(a){if(!a.length)return[];let b=0,c=a[0];if("number"!=typeof c)return[];let d=ag(c),e=[];for(;;){if(b===a.length-1){e.push(d);break}let c=a[b+1];if("number"!=typeof c)break;c<=d[1]?d[1]=c+7:(e.push(d),d=ag(c)),b++}return e}(c);if(d.every(b=>(function(a,b){let c=ac.get(a);if(void 0===c)return!1;for(let a=b[0];a<=b[1];a++)if(void 0===c[a])return!1;return!0})(a,b)))continue;let e=function(a,b,c){let d=a.get(b);return void 0===d?(a.set(b,c),c):d}(ac,a,{});f.push(function(a,b,c){return new Promise(d=>{let e=(0,aa.createReadStream)(a),f=(0,ab.createInterface)({input:e});function g(){e.destroy(),d()}let h=0,i=0,j=b[0];if(void 0===j)return void g();let k=j[0],l=j[1];function m(){ad.set(a,1),f.close(),f.removeAllListeners(),g()}e.on("error",m),f.on("error",m),f.on("close",g),f.on("line",a=>{if(!(++h<k)&&(c[h]=function(a,b){let c=a,d=c.length;if(d<=150)return c;b>d&&(b=d);let e=Math.max(b-60,0);e<5&&(e=0);let f=Math.min(e+140,d);return f>d-5&&(f=d),f===d&&(e=Math.max(f-140,0)),c=c.slice(e,f),e>0&&(c=`...${c}`),f<d&&(c+="..."),c}(a,0),h>=l)){if(i===b.length-1){f.close(),f.removeAllListeners();return}let a=b[++i];if(void 0===a){f.close(),f.removeAllListeners();return}k=a[0],l=a[1]}})})}(a,d,e))}return await Promise.all(f).catch(()=>{}),a&&a.length>0&&function(a,b){for(let c of a)if(c.filename&&void 0===c.context_line&&"number"==typeof c.lineno){let a=b.get(c.filename);if(void 0===a)continue;!function(a,b,c){if(void 0===b.lineno||void 0===c)return;b.pre_context=[];for(let d=ah(a);d<a;d++){let a=c[d];if(void 0===a)return void af(b);b.pre_context.push(a)}if(void 0===c[a])return af(b);b.context_line=c[a];let d=function(a){return a+7}(a);b.post_context=[];for(let e=a+1;e<=d;e++){let a=c[e];if(void 0===a)break;b.post_context.push(a)}}(c.lineno,c,a)}}(a,ac),ac.reduce(),a}function af(a){delete a.pre_context,delete a.context_line,delete a.post_context}function ag(a){return[ah(a),a+7]}function ah(a){return Math.max(1,a-7)}class ai{constructor(a,b,c){this.client=a,this._exceptionAutocaptureEnabled=b.enableExceptionAutocapture||!1,this._logger=c,this._rateLimiter=new z({refillRate:1,bucketSize:10,refillInterval:1e4,_logger:this._logger}),this.startAutocaptureIfEnabled()}static async buildEventMessage(a,b,c,d){let e={...d};c||(e.$process_person_profile=!1);let f=this.errorPropertiesBuilder.buildFromUnknown(a,b);return f.$exception_list=await this.errorPropertiesBuilder.modifyFrames(f.$exception_list),{event:"$exception",distinctId:c||p(),properties:{...f,...e}}}startAutocaptureIfEnabled(){if(this.isEnabled()){var a,b,c;let d;a=this.onException.bind(this),b=this.onFatalError.bind(this),global.process.on("uncaughtException",(d=!1,Object.assign(c=>{let e=global.process.listeners("uncaughtException").filter(a=>"domainUncaughtExceptionClear"!==a.name&&!0!==a._posthogErrorHandler).length;a(c,{mechanism:{type:"onuncaughtexception",handled:!1}}),d||0!==e||(d=!0,b(c))},{_posthogErrorHandler:!0}))),c=this.onException.bind(this),global.process.on("unhandledRejection",a=>c(a,{mechanism:{type:"onunhandledrejection",handled:!1}}))}}onException(a,b){this.client.addPendingPromise((async()=>{let c=await ai.buildEventMessage(a,b),d=c.properties,e=d?.$exception_list[0]?.type??"Exception";return this._rateLimiter.consumeRateLimit(e)?void this._logger.info("Skipping exception capture because of client rate limiting.",{exception:e}):this.client.capture(c)})())}async onFatalError(a){console.error(a),await this.client.shutdown(2e3),process.exit(1)}isEnabled(){return!this.client.isDisabled&&this._exceptionAutocaptureEnabled}shutdown(){this._rateLimiter.stop()}}class aj{constructor(a){this.factory=a}async getValue(){return void 0!==this.value?this.value:(void 0===this.initializationPromise&&(this.initializationPromise=(async()=>{try{let a=await this.factory();return this.value=a,a}finally{this.initializationPromise=void 0}})()),this.initializationPromise)}isInitialized(){return void 0!==this.value}async waitForInitialization(){this.isInitialized()||await this.getValue()}}let ak=new aj(async()=>{try{return await Promise.resolve().then(c.t.bind(c,55511,19))}catch{return}});async function al(){return await ak.getValue()}let am=new aj(async()=>{if(void 0!==globalThis.crypto?.subtle)return globalThis.crypto.subtle;try{let a=await ak.getValue();if(a?.webcrypto?.subtle)return a.webcrypto.subtle}catch{}});async function an(){return await am.getValue()}async function ao(a){let b=await al();if(b)return b.createHash("sha1").update(a).digest("hex");let c=await an();if(c)return Array.from(new Uint8Array(await c.digest("SHA-1",new TextEncoder().encode(a)))).map(a=>a.toString(16).padStart(2,"0")).join("");throw Error("No crypto implementation available. Tried Node Crypto API and Web SubtleCrypto API")}let ap=["is_not"];class aq extends Error{constructor(a){super(),Error.captureStackTrace(this,this.constructor),this.name="ClientError",this.message=a,Object.setPrototypeOf(this,aq.prototype)}}class ar extends Error{constructor(a){super(a),this.name=this.constructor.name,Error.captureStackTrace(this,this.constructor),Object.setPrototypeOf(this,ar.prototype)}}class as{constructor({pollingInterval:a,personalApiKey:b,projectApiKey:c,timeout:d,host:e,customHeaders:f,...g}){this.debugMode=!1,this.shouldBeginExponentialBackoff=!1,this.backOffCount=0,this.pollingInterval=a,this.personalApiKey=b,this.featureFlags=[],this.featureFlagsByKey={},this.groupTypeMapping={},this.cohorts={},this.loadedSuccessfullyOnce=!1,this.timeout=d,this.projectApiKey=c,this.host=e,this.poller=void 0,this.fetch=g.fetch||fetch,this.onError=g.onError,this.customHeaders=f,this.onLoad=g.onLoad,this.loadFeatureFlags()}debug(a=!0){this.debugMode=a}logMsgIfDebug(a){this.debugMode&&a()}async getFeatureFlag(a,b,c={},d={},e={}){let f,g;if(await this.loadFeatureFlags(),!this.loadedSuccessfullyOnce)return f;if(void 0!==(g=this.featureFlagsByKey[a]))try{f=(await this.computeFlagAndPayloadLocally(g,b,c,d,e)).value,this.logMsgIfDebug(()=>console.debug(`Successfully computed flag locally: ${a} -> ${f}`))}catch(b){b instanceof ar?this.logMsgIfDebug(()=>console.debug(`InconclusiveMatchError when computing flag locally: ${a}: ${b}`)):b instanceof Error&&this.onError?.(Error(`Error computing flag locally: ${a}: ${b}`))}return f}async getAllFlagsAndPayloads(a,b={},c={},d={},e){await this.loadFeatureFlags();let f={},g={},h=0==this.featureFlags.length,i=e?e.map(a=>this.featureFlagsByKey[a]).filter(Boolean):this.featureFlags,j={};return await Promise.all(i.map(async e=>{try{let{value:h,payload:i}=await this.computeFlagAndPayloadLocally(e,a,b,c,d,void 0,j);f[e.key]=h,i&&(g[e.key]=i)}catch(a){a instanceof ar?this.logMsgIfDebug(()=>console.debug(`InconclusiveMatchError when computing flag locally: ${e.key}: ${a}`)):a instanceof Error&&this.onError?.(Error(`Error computing flag locally: ${e.key}: ${a}`)),h=!0}})),{response:f,payloads:g,fallbackToFlags:h}}async computeFlagAndPayloadLocally(a,b,c={},d={},e={},f,g,h=!1){let i;if(h||await this.loadFeatureFlags(),!this.loadedSuccessfullyOnce)return{value:!1,payload:null};i=void 0!==f?f:await this.computeFlagValueLocally(a,b,c,d,e,g);let j=this.getFeatureFlagPayload(a.key,i);return{value:i,payload:j}}async computeFlagValueLocally(a,b,c={},d={},e={},f={}){if(a.ensure_experience_continuity)throw new ar("Flag has experience continuity enabled");if(!a.active)return!1;let g=(a.filters||{}).aggregation_group_type_index;if(void 0==g)return await this.matchFeatureFlagProperties(a,b,d,f);{let b=this.groupTypeMapping[String(g)];if(!b)throw this.logMsgIfDebug(()=>console.warn(`[FEATURE FLAGS] Unknown group type index ${g} for feature flag ${a.key}`)),new ar("Flag has unknown group type index");if(!(b in c))return this.logMsgIfDebug(()=>console.warn(`[FEATURE FLAGS] Can't compute group feature flag: ${a.key} without group names passed in`)),!1;let d=e[b];return await this.matchFeatureFlagProperties(a,c[b],d,f)}}getFeatureFlagPayload(a,b){let c=null;if(!1!==b&&null!=b&&("boolean"==typeof b?c=this.featureFlagsByKey?.[a]?.filters?.payloads?.[b.toString()]||null:"string"==typeof b&&(c=this.featureFlagsByKey?.[a]?.filters?.payloads?.[b]||null),null!=c)){if("object"==typeof c)return c;if("string"==typeof c)try{return JSON.parse(c)}catch{}return c}return null}async evaluateFlagDependency(a,b,c,d){let e=a.key;if(!this.featureFlagsByKey)throw new ar("Feature flags not available for dependency evaluation");if(!("dependency_chain"in a))throw new ar(`Flag dependency property for '${e}' is missing required 'dependency_chain' field`);let f=a.dependency_chain;if(!Array.isArray(f))throw new ar(`Flag dependency property for '${e}' has an invalid 'dependency_chain' (expected array, got ${typeof f})`);if(0===f.length)throw new ar(`Circular dependency detected for flag '${e}' (empty dependency chain)`);for(let a of f){if(!(a in d)){let f=this.featureFlagsByKey[a];if(f)if(f.active)try{let e=await this.matchFeatureFlagProperties(f,b,c,d);d[a]=e}catch(b){throw new ar(`Error evaluating flag dependency '${a}' for flag '${e}': ${b}`)}else d[a]=!1;else throw new ar(`Missing flag dependency '${a}' for flag '${e}'`)}if(null==d[a])throw new ar(`Dependency '${a}' could not be evaluated`)}let g=d[e];return this.flagEvaluatesToExpectedValue(a.value,g)}flagEvaluatesToExpectedValue(a,b){return"boolean"==typeof a?a===b||"string"==typeof b&&""!==b&&!0===a:"string"==typeof a&&b===a}async matchFeatureFlagProperties(a,b,c,d={}){let e,f=a.filters||{},g=f.groups||[],h=!1;for(let i of g)try{if(await this.isConditionMatch(a,b,i,c,d)){let c=i.variant,d=f.multivariate?.variants||[];e=c&&d.some(a=>a.key===c)?c:await this.getMatchingVariant(a,b)||!0;break}}catch(a){if(a instanceof ar)h=!0;else throw a}if(void 0!==e)return e;if(h)throw new ar("Can't determine if feature flag is enabled or not with given properties");return!1}async isConditionMatch(a,b,c,d,e={}){let f=c.rollout_percentage,g=a=>{this.logMsgIfDebug(()=>console.warn(a))};if((c.properties||[]).length>0){for(let a of c.properties){let c=a.type;if(!("cohort"===c?function a(b,c,d,e=!1){let f=String(b.value);if(!(f in d))throw new ar("can't match cohort without a given cohort property value");return function b(c,d,e,f=!1){if(!c)return!0;let g=c.type,h=c.values;if(!h||0===h.length)return!0;let i=!1;if("values"in h[0]){for(let a of h)try{let c=b(a,d,e,f);if("AND"===g){if(!c)return!1}else if(c)return!0}catch(b){if(b instanceof ar)f&&console.debug(`Failed to compute property ${a} locally: ${b}`),i=!0;else throw b}if(i)throw new ar("Can't match cohort without a given cohort property value");return"AND"===g}for(let b of h)try{let c;if("cohort"===b.type)c=a(b,d,e,f);else if("flag"===b.type){f&&console.warn(`[FEATURE FLAGS] Flag dependency filters are not supported in local evaluation. Skipping condition with dependency on flag '${b.key||"unknown"}'`);continue}else c=au(b,d);let h=b.negation||!1;if("AND"===g){if(!c&&!h||c&&h)return!1}else if(c&&!h||!c&&h)return!0}catch(a){if(a instanceof ar)f&&console.debug(`Failed to compute property ${b} locally: ${a}`),i=!0;else throw a}if(i)throw new ar("can't match cohort without a given cohort property value");return"AND"===g}(d[f],c,d,e)}(a,d,this.cohorts,this.debugMode):"flag"===c?await this.evaluateFlagDependency(a,b,d,e):au(a,d,g)))return!1}if(void 0==f)return!0}return!(void 0!=f&&await at(a.key,b)>f/100)}async getMatchingVariant(a,b){let c=await at(a.key,b,"variant"),d=this.variantLookupTable(a).find(a=>c>=a.valueMin&&c<a.valueMax);if(d)return d.key}variantLookupTable(a){let b=[],c=0,d=0,e=a.filters||{};return(e.multivariate?.variants||[]).forEach(a=>{d=c+a.rollout_percentage/100,b.push({valueMin:c,valueMax:d,key:a.key}),c=d}),b}async loadFeatureFlags(a=!1){(!this.loadedSuccessfullyOnce||a)&&await this._loadFeatureFlags()}isLocalEvaluationReady(){return(this.loadedSuccessfullyOnce??!1)&&(this.featureFlags?.length??0)>0}getPollingInterval(){return this.shouldBeginExponentialBackoff?Math.min(6e4,this.pollingInterval*2**this.backOffCount):this.pollingInterval}async _loadFeatureFlags(){this.poller&&(clearTimeout(this.poller),this.poller=void 0),this.poller=setTimeout(()=>this._loadFeatureFlags(),this.getPollingInterval());try{let a=await this._requestFeatureFlagDefinitions();if(!a)return;switch(a.status){case 401:throw this.shouldBeginExponentialBackoff=!0,this.backOffCount+=1,new aq(`Your project key or personal API key is invalid. Setting next polling interval to ${this.getPollingInterval()}ms. More information: https://posthog.com/docs/api#rate-limiting`);case 402:console.warn("[FEATURE FLAGS] Feature flags quota limit exceeded - unsetting all local flags. Learn more about billing limits at https://posthog.com/docs/billing/limits-alerts"),this.featureFlags=[],this.featureFlagsByKey={},this.groupTypeMapping={},this.cohorts={};return;case 403:throw this.shouldBeginExponentialBackoff=!0,this.backOffCount+=1,new aq(`Your personal API key does not have permission to fetch feature flag definitions for local evaluation. Setting next polling interval to ${this.getPollingInterval()}ms. Are you sure you're using the correct personal and Project API key pair? More information: https://posthog.com/docs/api/overview`);case 429:throw this.shouldBeginExponentialBackoff=!0,this.backOffCount+=1,new aq(`You are being rate limited. Setting next polling interval to ${this.getPollingInterval()}ms. More information: https://posthog.com/docs/api#rate-limiting`);case 200:{let b=await a.json()??{};if(!("flags"in b))return void this.onError?.(Error(`Invalid response when getting feature flags: ${JSON.stringify(b)}`));this.featureFlags=b.flags??[],this.featureFlagsByKey=this.featureFlags.reduce((a,b)=>(a[b.key]=b,a),{}),this.groupTypeMapping=b.group_type_mapping||{},this.cohorts=b.cohorts||{},this.loadedSuccessfullyOnce=!0,this.shouldBeginExponentialBackoff=!1,this.backOffCount=0,this.onLoad?.(this.featureFlags.length);break}default:return}}catch(a){a instanceof aq&&this.onError?.(a)}}getPersonalApiKeyRequestOptions(a="GET"){return{method:a,headers:{...this.customHeaders,"Content-Type":"application/json",Authorization:`Bearer ${this.personalApiKey}`}}}async _requestFeatureFlagDefinitions(){let a=`${this.host}/api/feature_flag/local_evaluation?token=${this.projectApiKey}&send_cohorts`,b=this.getPersonalApiKeyRequestOptions(),c=null;if(this.timeout&&"number"==typeof this.timeout){let a=new AbortController;c=D(()=>{a.abort()},this.timeout),b.signal=a.signal}try{return await this.fetch(a,b)}finally{clearTimeout(c)}}stopPoller(){clearTimeout(this.poller)}}async function at(a,b,c=""){return parseInt((await ao(`${a}.${b}${c}`)).slice(0,15),16)/0x1000000000000000}function au(a,b,c){let d=a.key,e=a.value,f=a.operator||"exact";if(d in b){if("is_not_set"===f)throw new ar("Operator is_not_set is not supported")}else throw new ar(`Property ${d} not found in propertyValues`);let g=b[d];if(null==g&&!ap.includes(f))return c&&c(`Property ${d} cannot have a value of null/undefined with the ${f} operator`),!1;function h(a,b){return Array.isArray(a)?a.map(a=>String(a).toLowerCase()).includes(String(b).toLowerCase()):String(a).toLowerCase()===String(b).toLowerCase()}function i(a,b,c){if("gt"===c)return a>b;if("gte"===c)return a>=b;if("lt"===c)return a<b;if("lte"===c)return a<=b;throw Error(`Invalid operator: ${c}`)}switch(f){case"exact":return h(e,g);case"is_not":return!h(e,g);case"is_set":return d in b;case"icontains":return String(g).toLowerCase().includes(String(e).toLowerCase());case"not_icontains":return!String(g).toLowerCase().includes(String(e).toLowerCase());case"regex":return av(String(e))&&null!==String(g).match(String(e));case"not_regex":return av(String(e))&&null===String(g).match(String(e));case"gt":case"gte":case"lt":case"lte":{let a="number"==typeof e?e:null;if("string"==typeof e)try{a=parseFloat(e)}catch(a){}if(null==a||null==g)return i(String(g),String(e),f);if("string"==typeof g)return i(g,String(e),f);return i(g,a,f)}case"is_date_after":case"is_date_before":{if("boolean"==typeof e)throw new ar("Date operations cannot be performed on boolean values");let a=function(a){let b=a.match(/^-?(?<number>[0-9]+)(?<interval>[a-z])$/),c=new Date(new Date().toISOString());if(!b)return null;{if(!b.groups)return null;let a=parseInt(b.groups.number);if(a>=1e4)return null;let d=b.groups.interval;if("h"==d)c.setUTCHours(c.getUTCHours()-a);else if("d"==d)c.setUTCDate(c.getUTCDate()-a);else if("w"==d)c.setUTCDate(c.getUTCDate()-7*a);else if("m"==d)c.setUTCMonth(c.getUTCMonth()-a);else{if("y"!=d)return null;c.setUTCFullYear(c.getUTCFullYear()-a)}return c}}(String(e));if(null==a&&(a=aw(e)),null==a)throw new ar(`Invalid date: ${e}`);let b=aw(g);if(["is_date_before"].includes(f))return b<a;return b>a}default:throw new ar(`Unknown operator: ${f}`)}}function av(a){try{return new RegExp(a),!0}catch(a){return!1}}function aw(a){if(a instanceof Date)return a;if("string"==typeof a||"number"==typeof a){let b=new Date(a);if(!isNaN(b.valueOf()))return b;throw new ar(`${a} is in an invalid date format`)}throw new ar(`The date provided ${a} must be a string, number, or date object`)}class ax{getProperty(a){return this._memoryStorage[a]}setProperty(a,b){this._memoryStorage[a]=null!==b?b:void 0}constructor(){this._memoryStorage={}}}let ay=(a,b)=>{let c={_log:(c,...d)=>{b(()=>{(0,console[c])(a,...d)})},info:(...a)=>{c._log("log",...a)},warn:(...a)=>{c._log("warn",...a)},error:(...a)=>{c._log("error",...a)},critical:(...b)=>{console.error(a,...b)},uninitializedWarning:a=>{c.error(`You must initialize PostHog before calling ${a}`)},createLogger:c=>ay(`${a} ${c}`,b)};return c};class az extends N{constructor(a,b={}){if(super(a,b),this._memoryStorage=new ax,this.options=b,this.logger=ay("[PostHog.js]",this.logMsgIfDebug.bind(this)),this.options.featureFlagsPollingInterval="number"==typeof b.featureFlagsPollingInterval?Math.max(b.featureFlagsPollingInterval,100):3e4,b.personalApiKey){if(b.personalApiKey.includes("phc_"))throw Error('Your Personal API key is invalid. These keys are prefixed with "phx_" and can be created in PostHog project settings.');!1!==b.enableLocalEvaluation&&(this.featureFlagsPoller=new as({pollingInterval:this.options.featureFlagsPollingInterval,personalApiKey:b.personalApiKey,projectApiKey:a,timeout:b.requestTimeout??1e4,host:this.host,fetch:b.fetch,onError:a=>{this._events.emit("error",a)},onLoad:a=>{this._events.emit("localEvaluationFlagsLoaded",a)},customHeaders:this.getCustomHeaders()}))}this.errorTracking=new ai(this,b,this.logger),this.distinctIdHasSentFlagCalls={},this.maxCacheSize=b.maxCacheSize||5e4}getPersistedProperty(a){return this._memoryStorage.getProperty(a)}setPersistedProperty(a,b){return this._memoryStorage.setProperty(a,b)}fetch(a,b){return this.options.fetch?this.options.fetch(a,b):fetch(a,b)}getLibraryVersion(){return"5.9.1"}getCustomUserAgent(){return`${this.getLibraryId()}/${this.getLibraryVersion()}`}enable(){return super.optIn()}disable(){return super.optOut()}debug(a=!0){super.debug(a),this.featureFlagsPoller?.debug(a)}capture(a){"string"==typeof a&&this.logMsgIfDebug(()=>console.warn("Called capture() with a string as the first argument when an object was expected.")),this.addPendingPromise(this.prepareEventMessage(a).then(({distinctId:a,event:b,properties:c,options:d})=>super.captureStateless(a,b,c,{timestamp:d.timestamp,disableGeoip:d.disableGeoip,uuid:d.uuid})).catch(a=>{a&&console.error(a)}))}async captureImmediate(a){return"string"==typeof a&&this.logMsgIfDebug(()=>console.warn("Called captureImmediate() with a string as the first argument when an object was expected.")),this.addPendingPromise(this.prepareEventMessage(a).then(({distinctId:a,event:b,properties:c,options:d})=>super.captureStatelessImmediate(a,b,c,{timestamp:d.timestamp,disableGeoip:d.disableGeoip,uuid:d.uuid})).catch(a=>{a&&console.error(a)}))}identify({distinctId:a,properties:b,disableGeoip:c}){let d=b?.$set_once;delete b?.$set_once;let e=b?.$set||b;super.identifyStateless(a,{$set:e,$set_once:d},{disableGeoip:c})}async identifyImmediate({distinctId:a,properties:b,disableGeoip:c}){let d=b?.$set_once;delete b?.$set_once;let e=b?.$set||b;await super.identifyStatelessImmediate(a,{$set:e,$set_once:d},{disableGeoip:c})}alias(a){super.aliasStateless(a.alias,a.distinctId,void 0,{disableGeoip:a.disableGeoip})}async aliasImmediate(a){await super.aliasStatelessImmediate(a.alias,a.distinctId,void 0,{disableGeoip:a.disableGeoip})}isLocalEvaluationReady(){return this.featureFlagsPoller?.isLocalEvaluationReady()??!1}async waitForLocalEvaluationReady(a=3e4){return!!this.isLocalEvaluationReady()||void 0!==this.featureFlagsPoller&&new Promise(b=>{let c=setTimeout(()=>{d(),b(!1)},a),d=this._events.on("localEvaluationFlagsLoaded",a=>{clearTimeout(c),d(),b(a>0)})})}async getFeatureFlag(a,b,c){let d,e,{groups:f,disableGeoip:g}=c||{},{onlyEvaluateLocally:h,sendFeatureFlagEvents:i,personProperties:k,groupProperties:l}=c||{},m=this.addLocalPersonAndGroupProperties(b,f,k,l);k=m.allPersonProperties,l=m.allGroupProperties,void 0==h&&(h=!1),void 0==i&&(i=this.options.sendFeatureFlagEvent??!0);let n=await this.featureFlagsPoller?.getFeatureFlag(a,b,f,k,l),o=void 0!==n;if(!o&&!h){let c=await super.getFeatureFlagDetailStateless(a,b,f,k,l,g);if(void 0===c)return;n=j(e=c.response),d=c?.requestId}let p=`${a}_${n}`;return!i||b in this.distinctIdHasSentFlagCalls&&this.distinctIdHasSentFlagCalls[b].includes(p)||(Object.keys(this.distinctIdHasSentFlagCalls).length>=this.maxCacheSize&&(this.distinctIdHasSentFlagCalls={}),Array.isArray(this.distinctIdHasSentFlagCalls[b])?this.distinctIdHasSentFlagCalls[b].push(p):this.distinctIdHasSentFlagCalls[b]=[p],this.capture({distinctId:b,event:"$feature_flag_called",properties:{$feature_flag:a,$feature_flag_response:n,$feature_flag_id:e?.metadata?.id,$feature_flag_version:e?.metadata?.version,$feature_flag_reason:e?.reason?.description??e?.reason?.code,locally_evaluated:o,[`$feature/${a}`]:n,$feature_flag_request_id:d},groups:f,disableGeoip:g})),n}async getFeatureFlagPayload(a,b,c,d){let e,{groups:f,disableGeoip:g}=d||{},{onlyEvaluateLocally:h,personProperties:i,groupProperties:j}=d||{},k=this.addLocalPersonAndGroupProperties(b,f,i,j);if(i=k.allPersonProperties,j=k.allGroupProperties,void 0!==this.featureFlagsPoller){await this.featureFlagsPoller?.loadFeatureFlags();let d=this.featureFlagsPoller?.featureFlagsByKey[a];if(d){let a=await this.featureFlagsPoller?.computeFlagAndPayloadLocally(d,b,f,i,j,c);a&&(c=a.value,e=a.payload)}}return void 0==h&&(h=!1),void 0!==e||h||(e=await super.getFeatureFlagPayloadStateless(a,b,f,i,j,g)),e}async getRemoteConfigPayload(a){if(!this.options.personalApiKey)throw Error("Personal API key is required for remote config payload decryption");let b=await this._requestRemoteConfigPayload(a);if(!b)return;let c=await b.json();if("string"==typeof c)try{return JSON.parse(c)}catch(a){}return c}async isFeatureEnabled(a,b,c){let d=await this.getFeatureFlag(a,b,c);if(void 0!==d)return!!d}async getAllFlags(a,b){return(await this.getAllFlagsAndPayloads(a,b)).featureFlags||{}}async getAllFlagsAndPayloads(a,b){let{groups:c,disableGeoip:d,flagKeys:e}=b||{},{onlyEvaluateLocally:f,personProperties:g,groupProperties:h}=b||{},i=this.addLocalPersonAndGroupProperties(a,c,g,h);g=i.allPersonProperties,h=i.allGroupProperties,void 0==f&&(f=!1);let j=await this.featureFlagsPoller?.getAllFlagsAndPayloads(a,c,g,h,e),k={},l={},m=!0;if(j&&(k=j.response,l=j.payloads,m=j.fallbackToFlags),m&&!f){let b=await super.getFeatureFlagsAndPayloadsStateless(a,c,g,h,d,e);k={...k,...b.flags||{}},l={...l,...b.payloads||{}}}return{featureFlags:k,featureFlagPayloads:l}}groupIdentify({groupType:a,groupKey:b,properties:c,distinctId:d,disableGeoip:e}){super.groupIdentifyStateless(a,b,c,{disableGeoip:e},d)}async reloadFeatureFlags(){await this.featureFlagsPoller?.loadFeatureFlags(!0)}async _shutdown(a){return this.featureFlagsPoller?.stopPoller(),this.errorTracking.shutdown(),super._shutdown(a)}async _requestRemoteConfigPayload(a){if(!this.options.personalApiKey)return;let b=`${this.host}/api/projects/@current/feature_flags/${a}/remote_config?token=${encodeURIComponent(this.apiKey)}`,c={method:"GET",headers:{...this.getCustomHeaders(),"Content-Type":"application/json",Authorization:`Bearer ${this.options.personalApiKey}`}},d=null;if(this.options.requestTimeout&&"number"==typeof this.options.requestTimeout){let a=new AbortController;d=D(()=>{a.abort()},this.options.requestTimeout),c.signal=a.signal}try{return await this.fetch(b,c)}catch(a){this._events.emit("error",a);return}finally{d&&clearTimeout(d)}}extractPropertiesFromEvent(a,b){if(!a)return{personProperties:{},groupProperties:{}};let c={},d={};for(let[e,f]of Object.entries(a))if(function(a){return"[object Object]"===Object.prototype.toString.call(a)}(f)&&b&&e in b){let a={};for(let[b,c]of Object.entries(f))a[String(b)]=String(c);d[String(e)]=a}else c[String(e)]=String(f);return{personProperties:c,groupProperties:d}}async getFeatureFlagsForEvent(a,b,c,d){let e=d?.personProperties||{},f=d?.groupProperties||{},g=d?.flagKeys;if(d?.onlyEvaluateLocally)if(!((this.featureFlagsPoller?.featureFlags?.length||0)>0))return{};else{let d={};for(let[a,c]of Object.entries(b||{}))d[a]=String(c);return await this.getAllFlags(a,{groups:d,personProperties:e,groupProperties:f,disableGeoip:c,onlyEvaluateLocally:!0,flagKeys:g})}if((this.featureFlagsPoller?.featureFlags?.length||0)>0){let d={};for(let[a,c]of Object.entries(b||{}))d[a]=String(c);return await this.getAllFlags(a,{groups:d,personProperties:e,groupProperties:f,disableGeoip:c,onlyEvaluateLocally:!0,flagKeys:g})}return(await super.getFeatureFlagsStateless(a,b,e,f,c)).flags}addLocalPersonAndGroupProperties(a,b,c,d){let e={distinct_id:a,...c||{}},f={};if(b)for(let a of Object.keys(b))f[a]={$group_key:b[a],...d?.[a]||{}};return{allPersonProperties:e,allGroupProperties:f}}captureException(a,b,c){let d=Error("PostHog syntheticException");this.addPendingPromise(ai.buildEventMessage(a,{syntheticException:d},b,c).then(a=>this.capture(a)))}async captureExceptionImmediate(a,b,c){let d=Error("PostHog syntheticException");this.addPendingPromise(ai.buildEventMessage(a,{syntheticException:d},b,c).then(a=>this.captureImmediate(a)))}async prepareEventMessage(a){let{distinctId:b,event:c,properties:d,groups:e,sendFeatureFlags:f,timestamp:g,disableGeoip:h,uuid:i}=a,j=this._runBeforeSend({distinctId:b,event:c,properties:d,groups:e,sendFeatureFlags:f,timestamp:g,disableGeoip:h,uuid:i});if(!j)return Promise.reject(null);let k=await Promise.resolve().then(async()=>f?await this.getFeatureFlagsForEvent(b,e,h,"object"==typeof f?f:void 0):{}).then(a=>{let b={};if(a)for(let[c,d]of Object.entries(a))b[`$feature/${c}`]=d;let c=Object.keys(a||{}).filter(b=>a?.[b]!==!1).sort();return c.length>0&&(b.$active_feature_flags=c),b}).catch(()=>({})).then(a=>({...a,...j.properties||{},$groups:j.groups||e}));return{distinctId:j.distinctId,event:j.event,properties:k,options:{timestamp:j.timestamp,disableGeoip:j.disableGeoip,uuid:j.uuid}}}_runBeforeSend(a){let b=this.options.before_send;if(!b)return a;let c=Array.isArray(b)?b:[b],d=a;for(let b of c){if(!(d=b(d)))return this.logMsgIfDebug(()=>console.info(`Event '${a.event}' was rejected in beforeSend function`)),null;if(!d.properties||0===Object.keys(d.properties).length){let a=`Event '${d.event}' has no properties after beforeSend function, this is likely an error.`;this.logMsgIfDebug(()=>console.warn(a))}}return d}}let aA="posthog-node";class aB{static #a=this.POSTHOG_ID_TAG="posthog_distinct_id";constructor(a,b,c,d,e){this.name=aA,this.name=aA,this.setupOnce=function(f,g){f(createEventProcessor(a,{organization:b,projectId:g()?.getClient()?.getDsn()?.projectId,prefix:c,severityAllowList:d,sendExceptionsToPostHog:e??!0}))}}}ai.errorPropertiesBuilder=new S([new Z,new T,new Y,new V,new $],[a=>{let b=a.match(P);if(b){let a,c,d,e,f;if(b[1]){let f=(d=b[1]).lastIndexOf(".");if("."===d[f-1]&&f--,f>0){a=d.slice(0,f),c=d.slice(f+1);let b=a.indexOf(".Module");b>0&&(d=d.slice(b+1),a=a.slice(0,b))}e=void 0}c&&(e=a,f=c),"<anonymous>"===c&&(f=void 0,d=void 0),void 0===d&&(f=f||"?",d=e?`${e}.${f}`:f);let g=b[2]?.startsWith("file://")?b[2].slice(7):b[2],h="native"===b[5];return g?.match(/\/[A-Z]:/)&&(g=g.slice(1)),g||!b[5]||h||(g=b[5]),{filename:g?decodeURI(g):void 0,module:void 0,function:d,lineno:Q(b[3]),colno:Q(b[4]),in_app:function(a,b=!1){return!(b||a&&!a.startsWith("/")&&!a.match(/^[A-Z]:/)&&!a.startsWith(".")&&!a.match(/^[a-zA-Z]([a-zA-Z0-9.\-+])*:\/\//))&&void 0!==a&&!a.includes("node_modules/")}(g||"",h),platform:"node:javascript"}}if(a.match(O))return{filename:a,platform:"node:javascript"}}],[function(){let a=function(a=process.argv[1]?(0,h.dirname)(process.argv[1]):process.cwd(),b="\\"===h.sep){let c=b?i(a):a;return a=>{if(!a)return;let d=b?i(a):a,{dir:e,base:f,ext:g}=h.posix.parse(d);(".js"===g||".mjs"===g||".cjs"===g)&&(f=f.slice(0,-1*g.length));let j=decodeURIComponent(f);e||(e=".");let k=e.lastIndexOf("/node_modules");if(k>-1)return`${e.slice(k+14).replace(/\//g,".")}:${j}`;if(e.startsWith(c)){let a=e.slice(c.length+1).replace(/\//g,".");return a?`${a}:${j}`:j}return j}}();return async b=>{for(let c of b)c.module=a(c.filename);return b}}(),ae]);class aC extends az{getLibraryId(){return"posthog-node"}}},34603:(a,b,c)=>{Object.defineProperty(b,"b",{enumerable:!0,get:function(){return m}});let d=c(67675),e=c(29294),f=c(63033),g=c(26906),h=c(11938),i=c(82831),j=c(30787),k=c(31716),l=c(49290);function m(){let a="headers",b=e.workAsyncStorage.getStore(),c=f.workUnitAsyncStorage.getStore();if(b){if(c&&"after"===c.phase&&!(0,k.isRequestAPICallableInsideAfter)())throw Object.defineProperty(Error(`Route ${b.route} used "headers" inside "after(...)". This is not supported. If you need this data inside an "after" callback, use "headers" outside of the callback. See more info here: https://nextjs.org/docs/canary/app/api-reference/functions/after`),"__NEXT_ERROR_CODE",{value:"E367",enumerable:!1,configurable:!0});if(b.forceStatic)return o(d.HeadersAdapter.seal(new Headers({})));if(c)switch(c.type){case"cache":{let a=Object.defineProperty(Error(`Route ${b.route} used "headers" inside "use cache". Accessing Dynamic data sources inside a cache scope is not supported. If you need this data inside a cached function use "headers" outside of the cached function and pass the required dynamic data in as an argument. See more info here: https://nextjs.org/docs/messages/next-request-in-use-cache`),"__NEXT_ERROR_CODE",{value:"E304",enumerable:!1,configurable:!0});throw Error.captureStackTrace(a,m),b.invalidDynamicUsageError??=a,a}case"private-cache":{let a=Object.defineProperty(Error(`Route ${b.route} used "headers" inside "use cache: private". Accessing "headers" inside a private cache scope is not supported. If you need this data inside a cached function use "headers" outside of the cached function and pass the required dynamic data in as an argument. See more info here: https://nextjs.org/docs/messages/next-request-in-use-cache`),"__NEXT_ERROR_CODE",{value:"E742",enumerable:!1,configurable:!0});throw Error.captureStackTrace(a,m),b.invalidDynamicUsageError??=a,a}case"unstable-cache":throw Object.defineProperty(Error(`Route ${b.route} used "headers" inside a function cached with "unstable_cache(...)". Accessing Dynamic data sources inside a cache scope is not supported. If you need this data inside a cached function use "headers" outside of the cached function and pass the required dynamic data in as an argument. See more info here: https://nextjs.org/docs/app/api-reference/functions/unstable_cache`),"__NEXT_ERROR_CODE",{value:"E127",enumerable:!1,configurable:!0})}if(b.dynamicShouldError)throw Object.defineProperty(new h.StaticGenBailoutError(`Route ${b.route} with \`dynamic = "error"\` couldn't be rendered statically because it used \`headers\`. See more info here: https://nextjs.org/docs/app/building-your-application/rendering/static-and-dynamic#dynamic-rendering`),"__NEXT_ERROR_CODE",{value:"E525",enumerable:!1,configurable:!0});if(c)switch(c.type){case"prerender":case"prerender-runtime":var j=b,p=c;let e=n.get(p);if(e)return e;let f=(0,i.makeHangingPromise)(p.renderSignal,j.route,"`headers()`");return n.set(p,f),f;case"prerender-client":let q="`headers`";throw Object.defineProperty(new l.InvariantError(`${q} must not be used within a client component. Next.js should be preventing ${q} from being included in client components statically, but did not in this case.`),"__NEXT_ERROR_CODE",{value:"E693",enumerable:!1,configurable:!0});case"prerender-ppr":return(0,g.postponeWithTracking)(b.route,a,c.dynamicTracking);case"prerender-legacy":return(0,g.throwToInterruptStaticGeneration)(a,b,c);case"request":return(0,g.trackDynamicDataInDynamicRender)(c),o(c.headers)}}(0,f.throwForMissingRequestStore)(a)}c(63036);let n=new WeakMap;function o(a){let b=n.get(a);if(b)return b;let c=Promise.resolve(a);return n.set(a,c),Object.defineProperties(c,{append:{value:a.append.bind(a)},delete:{value:a.delete.bind(a)},get:{value:a.get.bind(a)},has:{value:a.has.bind(a)},set:{value:a.set.bind(a)},getSetCookie:{value:a.getSetCookie.bind(a)},forEach:{value:a.forEach.bind(a)},keys:{value:a.keys.bind(a)},values:{value:a.values.bind(a)},entries:{value:a.entries.bind(a)},[Symbol.iterator]:{value:a[Symbol.iterator].bind(a)}}),c}(0,j.createDedupedByCallsiteServerErrorLoggerDev)(function(a,b){let c=a?`Route "${a}" `:"This route ";return Object.defineProperty(Error(`${c}used ${b}. \`headers()\` should be awaited before using its value. Learn more: https://nextjs.org/docs/messages/sync-dynamic-apis`),"__NEXT_ERROR_CODE",{value:"E277",enumerable:!1,configurable:!0})})},35916:(a,b,c)=>{let d=c(63033),e=c(29294),f=c(26906),g=c(30787),h=c(11938),i=c(69168),j=c(49290);c(63036);new WeakMap;(0,g.createDedupedByCallsiteServerErrorLoggerDev)(function(a,b){let c=a?`Route "${a}" `:"This route ";return Object.defineProperty(Error(`${c}used ${b}. \`draftMode()\` should be awaited before using its value. Learn more: https://nextjs.org/docs/messages/sync-dynamic-apis`),"__NEXT_ERROR_CODE",{value:"E377",enumerable:!1,configurable:!0})})},86802:(a,b,c)=>{c.d(b,{b3:()=>d.b}),c(14230);var d=c(34603);c(35916)}};