exports.id=798,exports.ids=[798],exports.modules={40050:(a,b,c)=>{"use strict";c.d(b,{hD:()=>q,kU:()=>s,Jb:()=>t,mq:()=>r});var d=c(86802),e=c(34198);let f={email:/([a-zA-Z0-9._%+-]+)@([a-zA-Z0-9.-]+\.[a-zA-Z]{2,})/gi,ipv4:/\b(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\b/g,ipv6:/\b(?:[A-F0-9]{1,4}:){7}[A-F0-9]{1,4}\b/gi,phone:/(\+?[0-9]{1,3}[-.\s]?)?\(?[0-9]{1,4}\)?[-.\s]?[0-9]{1,4}[-.\s]?[0-9]{1,4}/g,ssn:/\b\d{3}-\d{2}-\d{4}\b/g,creditCard:/\b\d{4}[\s-]?\d{4}[\s-]?\d{4}[\s-]?\d{4}\b/g,jwt:/eyJ[A-Za-z0-9-_=]+\.[A-Za-z0-9-_=]+\.?[A-Za-z0-9-_.+/=]*/g,apiKey:/\b[A-Za-z0-9]{32,}\b/g,uuid:/\b[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}\b/gi},g=["password","passwd","pwd","secret","token","api_key","apikey","auth","authorization","cookie","session","ssn","social_security","credit_card","creditcard","cc_number","cvv","pin","private_key","privatekey","email","phone","tel","mobile","address","street","zip","postal","dob","date_of_birth","birthdate","user_id","userid","username","user_name","first_name","firstname","last_name","lastname","full_name","fullname","name"],h=["authorization","cookie","x-api-key","x-auth-token","x-csrf-token","x-access-token"];function i(a){if(!a||"string"!=typeof a)return a;let b=a;return(b=(b=(b=(b=(b=(b=(b=(b=b.replace(f.email,(a,b,c)=>{let d=`${b.charAt(0)}***`;return`${d}@${c}`})).replace(f.ipv4,"***.***.***,***")).replace(f.ipv6,"****:****:****:****:****:****:****:****")).replace(f.phone,"***-***-****")).replace(f.ssn,"***-**-****")).replace(f.creditCard,"**** **** **** ****")).replace(f.jwt,a=>{let b=a.split(".");return b.length>=2?`${b[0]}.*****.***`:"***JWT***"})).replace(f.apiKey,a=>a.length>40?`${a.substring(0,4)}...${a.substring(a.length-4)}`:a)).replace(f.uuid,a=>{let b=a.split("-");return`${b[0]}-****-****-****-************`})}function j(a,b=0,c=10){if(b>c)return"[MAX_DEPTH_EXCEEDED]";if(null==a)return a;if("string"==typeof a)return i(a);if("object"!=typeof a)return a;if(Array.isArray(a))return a.map(a=>j(a,b+1,c));let d={};for(let[e,f]of Object.entries(a)){let a=e.toLowerCase();g.some(b=>a.includes(b))?"string"==typeof f&&f.length>0?d[e]=`[REDACTED:${e}]`:"object"==typeof f&&null!==f?d[e]="[REDACTED:OBJECT]":"number"==typeof f?d[e]="[REDACTED:NUMBER]":d[e]="[REDACTED]":d[e]=j(f,b+1,c)}return d}function k(a){let b={};for(let[c,d]of Object.entries(a)){let a=c.toLowerCase();h.includes(a)?Array.isArray(d)?b[c]=d.map(()=>"[REDACTED:HEADER]"):b[c]="[REDACTED:HEADER]":a.includes("auth")||a.includes("token")||a.includes("key")?b[c]="[REDACTED:AUTH]":Array.isArray(d)?b[c]=d.map(a=>i(a)):b[c]=i(d)}return b}class l{constructor(){if(this.posthog=null,this.isDevelopment=!1,this.isProduction=!0,this.isProduction&&process.env.NEXT_PUBLIC_POSTHOG_KEY&&process.env.NEXT_PUBLIC_POSTHOG_HOST)try{this.posthog=new e.f2(process.env.NEXT_PUBLIC_POSTHOG_KEY,{host:process.env.NEXT_PUBLIC_POSTHOG_HOST,flushAt:1,flushInterval:0})}catch(a){console.error("Failed to initialize PostHog for error tracking:",a)}}static getInstance(){return l.instance||(l.instance=new l),l.instance}async getRequestContext(a){let b={};try{if(a){b.method=a.method,b.endpoint=function(a){try{let b=new URL(a),c=new URLSearchParams(b.search),d=new URLSearchParams;for(let[a,b]of c.entries()){let c=a.toLowerCase();g.some(a=>c.includes(a))?d.set(a,"[REDACTED]"):d.set(a,i(b))}return b.search=d.toString(),b.toString()}catch(b){return i(a)}}(a.url);let c={};a.headers.forEach((a,b)=>{c[b]=a});let d=k(c);b.userAgent=d["user-agent"],b.referer=d.referer,b.contentType=d["content-type"]}else{let a=await (0,d.b3)(),c={};a.forEach((a,b)=>{c[b]=a});let e=k(c);b.userAgent=e["user-agent"],b.referer=e.referer}b.requestId=Math.random().toString(36).substring(7)}catch(a){console.error("Failed to extract request context:",a)}return b}async logError(a,b="error",c,d){try{let e=await this.getRequestContext(d),f=j({...e,...c}),g=function(a){if(!a)return{message:"Unknown error"};if(a instanceof Error){let b={message:i(a.message),name:a.name,stack:a.stack?i(a.stack):void 0};for(let c in a)["message","name","stack"].includes(c)||(b[c]=j(a[c]));return b}return"string"==typeof a?{message:i(a)}:"object"==typeof a?j(a):{message:String(a)}}(a),h={timestamp:new Date().toISOString(),severity:b,message:g.message,error:g,context:f,stack:g.stack,environment:this.isProduction?"production":"development"};if(this.isDevelopment?console.error("\n\uD83D\uDD34 ERROR TRACKED:",{...h,formattedTime:new Date(h.timestamp).toLocaleString()}):console.error(JSON.stringify(h)),this.posthog&&this.isProduction)try{this.posthog.capture({distinctId:f.userId||"anonymous",event:"api_error",properties:{severity:b,endpoint:f.endpoint,method:f.method,statusCode:f.statusCode,errorMessage:g.message,errorName:g.name,requestId:f.requestId,environment:h.environment,timestamp:h.timestamp}}),await this.posthog.flush()}catch(a){console.error("Failed to send error to PostHog:",a)}this.isDevelopment&&process.env.ERROR_LOG_FILE&&await this.writeToFile(h)}catch(b){console.error("Critical: Failed to log error:",b),console.error("Original error:",a)}}async logInfo(a,b,c){await this.logError(Error(a),"info",b,c)}async logWarning(a,b,c){await this.logError(Error(a),"warning",b,c)}async logCritical(a,b,c){await this.logError(a,"critical",b,c)}async writeToFile(a){try{let b=await Promise.resolve().then(c.t.bind(c,79748,23)),d=await Promise.resolve().then(c.t.bind(c,33873,23)),e=d.join(process.cwd(),"logs"),f=d.join(e,`errors-${new Date().toISOString().split("T")[0]}.log`);await b.mkdir(e,{recursive:!0}),await b.appendFile(f,`${JSON.stringify(a)}
`,"utf-8")}catch(a){console.error("Failed to write error to file:",a)}}async shutdown(){this.posthog&&await this.posthog.shutdown()}}let m=l.getInstance();async function n(a,b,c){return m.logError(a,"error",b,c)}async function o(a,b,c){return m.logWarning(a,b,c)}var p=c(10641);class q extends Error{constructor(a,b=500,c){super(a),this.statusCode=b,this.code=c,this.name="ApiError"}}function r(a,b={}){return async(c,d)=>{let e=Math.random().toString(36).substring(7),f=Date.now(),g={requestId:e,endpoint:b.endpoint||c.url,method:c.method};try{if(b.requireAuth&&!c.headers.get("authorization"))throw new q("Authentication required",401,"AUTH_REQUIRED");let h=await a(c,d),i=Date.now()-f;return i>3e3&&await o(`Slow API call: ${i}ms`,{...g,duration:i},c),h instanceof p.NextResponse&&h.headers.set("x-request-id",e),h}catch(j){let a=Date.now()-f,b=500,d="Internal server error",h="INTERNAL_ERROR";j instanceof q?(b=j.statusCode,d=j.message,h=j.code||"API_ERROR"):j instanceof Error&&(j.message.includes("Invalid JSON")?(b=400,d="Invalid request body",h="INVALID_JSON"):j.message.includes("not found")?(b=404,d="Resource not found",h="NOT_FOUND"):j.message.includes("unauthorized")||j.message.includes("auth")?(b=401,d="Unauthorized",h="UNAUTHORIZED"):j.message.includes("forbidden")?(b=403,d="Forbidden",h="FORBIDDEN"):d="An error occurred processing your request"),await n(j,{...g,statusCode:b,duration:a,errorCode:h},c);let i={ok:!1,error:d,requestId:e,timestamp:new Date().toISOString()};return p.NextResponse.json(i,{status:b,headers:{"x-request-id":e}})}}}function s(a,b={}){let c={ok:!0,data:a,requestId:b.requestId};return p.NextResponse.json(c,{status:b.status||200,headers:b.headers})}function t(a,b){if(!a||"object"!=typeof a)throw new q("Invalid request body",400,"INVALID_BODY");let c={};for(let[d,e]of Object.entries(b)){let b=a[d];if(e.required&&void 0===b)throw new q(`Missing required field: ${String(d)}`,400,"MISSING_FIELD");if(void 0!==b){if(e.type){let a=Array.isArray(b)?"array":typeof b;if(a!==e.type)throw new q(`Invalid type for ${String(d)}: expected ${e.type}, got ${a}`,400,"INVALID_TYPE")}if(e.validate&&!e.validate(b))throw new q(`Validation failed for field: ${String(d)}`,400,"VALIDATION_FAILED");c[d]=b}}return c}},78335:()=>{},96487:()=>{}};