exports.id=2498,exports.ids=[2498],exports.modules={78335:()=>{},82822:(a,b,c)=>{"use strict";c.d(b,{xu:()=>x});var d=function(a){return a.GET="GET",a.FROM="FROM",a.WHERE="WHERE",a.WITH="WITH",a.GROUP_BY="GROUP_BY",a.ORDER_BY="ORDER_BY",a.LIMIT="LIMIT",a.AND="AND",a.CONTAINS="CONTAINS",a.DOES_NOT_CONTAIN="DOES_NOT_CONTAIN",a.EQUALS="EQUALS",a.IS_GREATER_THAN="IS_GREATER_THAN",a.IS_LESS_THAN="IS_LESS_THAN",a.STARTS_WITH="STARTS_WITH",a.ENDS_WITH="ENDS_WITH",a.COUNT="COUNT",a.MIN="MIN",a.MAX="MAX",a.AVG="AVG",a.SUM="SUM",a.IDENTIFIER="IDENTIFIER",a.STRING="STRING",a.NUMBER="NUMBER",a.COMMA="COMMA",a.LPAREN="LPAREN",a.RPAREN="RPAREN",a.DOT="DOT",a.EOF="EOF",a.UNKNOWN="UNKNOWN",a}({});class e extends Error{constructor(a,b,c,d,e="error"){super(a),this.position=b,this.line=c,this.column=d,this.severity=e,this.name="QueryError"}}class f extends e{constructor(a,b){super(a,b?.position,b?.line,b?.column),this.name="ParseError"}}class g extends e{constructor(a,b){super(a),this.code=b,this.name="ExecutionError"}}class h{static{this.KEYWORDS=new Map([["get",d.GET],["from",d.FROM],["where",d.WHERE],["with",d.WITH],["group",d.GROUP_BY],["by",d.GROUP_BY],["order",d.ORDER_BY],["limit",d.LIMIT],["and",d.AND],["contains",d.CONTAINS],["does",d.DOES_NOT_CONTAIN],["not",d.DOES_NOT_CONTAIN],["contain",d.DOES_NOT_CONTAIN],["equals",d.EQUALS],["is",d.IS_GREATER_THAN],["greater",d.IS_GREATER_THAN],["less",d.IS_LESS_THAN],["than",d.IS_GREATER_THAN],["starts",d.STARTS_WITH],["ends",d.ENDS_WITH],["count",d.COUNT],["min",d.MIN],["max",d.MAX],["avg",d.AVG],["sum",d.SUM]])}static{this.OPERATOR_PATTERNS=[{pattern:/^does\s+not\s+contain/i,type:d.DOES_NOT_CONTAIN},{pattern:/^is\s+greater\s+than/i,type:d.IS_GREATER_THAN},{pattern:/^is\s+less\s+than/i,type:d.IS_LESS_THAN},{pattern:/^starts\s+with/i,type:d.STARTS_WITH},{pattern:/^ends\s+with/i,type:d.ENDS_WITH},{pattern:/^group\s+by/i,type:d.GROUP_BY},{pattern:/^order\s+by/i,type:d.ORDER_BY}]}constructor(a){this.position=0,this.line=1,this.column=1,this.tokens=[],this.input=a}tokenize(){for(this.tokens=[],this.position=0,this.line=1,this.column=1;!this.isEOF()&&(this.skipWhitespace(),!this.isEOF());){let a=this.nextToken();a.type!==d.UNKNOWN&&this.tokens.push(a)}return this.tokens.push(this.createToken(d.EOF,"")),this.tokens}nextToken(){let a=this.position,b=this.line,c=this.column;for(let{pattern:d,type:e}of h.OPERATOR_PATTERNS){let f=this.input.slice(this.position).match(d);if(f&&0===f.index){let d=f[0];return this.advance(d.length),this.createTokenAt(e,d,a,b,c)}}let e=this.peek();if('"'===e||"'"===e)return this.readString();if(this.isDigit(e))return this.readNumber();if(this.isAlpha(e))return this.readIdentifier();switch(e){case",":return this.advance(),this.createTokenAt(d.COMMA,",",a,b,c);case"(":return this.advance(),this.createTokenAt(d.LPAREN,"(",a,b,c);case")":return this.advance(),this.createTokenAt(d.RPAREN,")",a,b,c);case".":return this.advance(),this.createTokenAt(d.DOT,".",a,b,c);default:return this.advance(),this.createTokenAt(d.UNKNOWN,e,a,b,c)}}readString(){let a=this.position,b=this.line,c=this.column,f=this.peek();this.advance();let g="",h=!1;for(;!this.isEOF()&&(h||this.peek()!==f);){let a=this.peek();if(h){switch(a){case"n":g+="\n";break;case"t":g+="	";break;case"r":g+="\r";break;case"\\":g+="\\";break;case'"':g+='"';break;case"'":g+="'";break;default:g+=a}h=!1}else"\\"===a?h=!0:g+=a;this.advance()}if(this.isEOF())throw new e("Unterminated string literal",a,b,c);return this.advance(),this.createTokenAt(d.STRING,g,a,b,c)}readNumber(){let a=this.position,b=this.line,c=this.column,e="";for(;!this.isEOF()&&this.isDigit(this.peek());)e+=this.peek(),this.advance();if(!this.isEOF()&&"."===this.peek()&&this.isDigit(this.peek(1)))for(e+=this.peek(),this.advance();!this.isEOF()&&this.isDigit(this.peek());)e+=this.peek(),this.advance();return this.createTokenAt(d.NUMBER,e,a,b,c)}readIdentifier(){let a=this.position,b=this.line,c=this.column,e="";for(;!this.isEOF()&&(this.isAlphaNumeric(this.peek())||"_"===this.peek()||" "===this.peek());){let a=this.peek();if(" "===a){let b=this.peek(1);if(!b||!this.isAlpha(b))break;let c=this.input.slice(this.position).match(/^[A-Za-z\s]+/);if(c&&this.isKnownField(c[0].trim()))e+=a,this.advance();else break}else e+=a,this.advance()}let f=(e=e.trim()).toLowerCase(),g=h.KEYWORDS.get(f);return g?([d.COUNT,d.MIN,d.MAX,d.AVG,d.SUM].includes(g)&&(this.skipWhitespace(),this.peek()),this.createTokenAt(g,e,a,b,c)):this.createTokenAt(d.IDENTIFIER,e,a,b,c)}isKnownField(a){return["computer name","computer role","operating system","os platform","os version","disk free gb","memory gb","cpu percent","compliance score","group name","group","location","last reboot","last seen","service status","ip address","mac address","serial number","manufacturer","model"].includes(a.toLowerCase())}skipWhitespace(){for(;!this.isEOF()&&this.isWhitespace(this.peek());)"\n"===this.peek()?(this.line++,this.column=1):this.column++,this.position++}isWhitespace(a){return/\s/.test(a)}isDigit(a){return/\d/.test(a)}isAlpha(a){return/[a-zA-Z]/.test(a)}isAlphaNumeric(a){return/[a-zA-Z0-9]/.test(a)}peek(a=0){let b=this.position+a;return b>=this.input.length?"\0":this.input[b]}advance(a=1){for(let b=0;b<a;b++)this.position<this.input.length&&("\n"===this.input[this.position]?(this.line++,this.column=1):this.column++,this.position++)}isEOF(){return this.position>=this.input.length}createToken(a,b){return{type:a,value:b,position:this.position,line:this.line,column:this.column}}createTokenAt(a,b,c,d,e){return{type:a,value:b,position:c,line:d,column:e}}getTokens(){return this.tokens}formatTokens(){return this.tokens.map(a=>`${a.type}(${a.value}) @ ${a.line}:${a.column}`).join("\n")}}class i{constructor(a={}){this.tokens=[],this.current=0,this.options={strictMode:!1,allowPartialQueries:!1,maxDepth:100,validateSemantics:!0,...a}}parse(a){let b=new h(a);this.tokens=b.tokenize(),this.current=0;let c=this.parseQuery();return this.options.validateSemantics&&this.validateQuery(c),c}parseQuery(){let a,b,c,e,g=this.peek();if(!this.match(d.GET))throw new f('Query must start with "Get"',this.peek());let h=this.parseSelect();if(!this.match(d.FROM))throw new f('Expected "from" after column list',this.peek());let i=this.parseFrom();return(this.match(d.WHERE)||this.match(d.WITH))&&(a=this.parseWhere()),(this.matchSequence([d.GROUP_BY])||this.check(d.IDENTIFIER)&&this.peekValue()?.toLowerCase()==="group")&&(b=this.parseGroupBy()),(this.matchSequence([d.ORDER_BY])||this.check(d.IDENTIFIER)&&this.peekValue()?.toLowerCase()==="order")&&(c=this.parseOrderBy()),this.match(d.LIMIT)&&(e=this.parseLimit()),{type:"Query",select:h,from:i,where:a,groupBy:b,orderBy:c,limit:e,location:this.createLocation(g,this.previous())}}parseSelect(){let a=this.peek(),b=[],c=[];do if(this.checkAggregate())c.push(this.parseAggregate());else{let a=this.parseColumn();a&&b.push(a)}while(this.match(d.COMMA)||this.check(d.IDENTIFIER)&&this.peekValue()?.toLowerCase()==="and"&&!this.checkAhead(d.FROM));if(0===b.length&&0===c.length)throw new f("Expected at least one column or aggregate",this.peek());return{type:"Select",columns:b,aggregates:c,location:this.createLocation(a,this.previous())}}parseColumn(){let a=this.peek(),b="";for(;this.check(d.IDENTIFIER)&&(b&&(b+=" "),b+=this.advance().value,this.checkColumnContinuation()););return b?{type:"Column",name:b,location:this.createLocation(a,this.previous())}:null}parseAggregate(){let a,b,c=this.peek(),e=this.advance();switch(e.type){case d.COUNT:a="count";break;case d.MIN:a="min";break;case d.MAX:a="max";break;case d.AVG:a="avg";break;case d.SUM:a="sum";break;default:throw new f(`Unknown aggregate function: ${e.value}`,e)}if(this.match(d.LPAREN)){if(!this.check(d.RPAREN)){let a=this.parseColumn();a&&(b=a.name)}this.consume(d.RPAREN,"Expected closing parenthesis")}return{type:"Aggregate",function:a,column:b,location:this.createLocation(c,this.previous())}}parseFrom(){let a=this.peek();return{type:"From",scope:this.parseScope(),location:this.createLocation(a,this.previous())}}parseScope(){let a=this.peek();if(this.check(d.IDENTIFIER)){let b=this.peekValue()?.toLowerCase();if("all"===b)return this.advance(),this.check(d.IDENTIFIER)&&this.peekValue()?.toLowerCase()==="machines"&&this.advance(),{type:"Scope",scopeType:"all",location:this.createLocation(a,this.previous())};if("group"===b){this.advance();let b="";if(this.check(d.STRING))b=this.advance().value;else for(;this.check(d.IDENTIFIER)&&(b&&(b+=" "),b+=this.advance().value,this.checkGroupNameContinuation()););return{type:"Scope",scopeType:"group",value:b,location:this.createLocation(a,this.previous())}}}return{type:"Scope",scopeType:"all",location:this.createLocation(a,a)}}parseWhere(){let a=this.previous(),b=[];do b.push(this.parseFilter());while(this.match(d.AND));return{type:"Where",filters:b,location:this.createLocation(a,this.previous())}}parseFilter(){let a,b=this.peek(),c=this.parseColumn();if(!c)throw new f("Expected field name in filter",this.peek());let e=this.parseOperator();if(this.check(d.STRING))a=this.advance().value;else if(this.check(d.NUMBER))a=parseFloat(this.advance().value);else{let b="";for(;this.check(d.IDENTIFIER)&&(b&&(b+=" "),b+=this.advance().value,this.checkFilterValueContinuation()););a=b}return{type:"Filter",field:c.name,operator:e,value:a,location:this.createLocation(b,this.previous())}}parseOperator(){if(this.match(d.CONTAINS))return"contains";if(this.match(d.DOES_NOT_CONTAIN))return"does_not_contain";if(this.match(d.EQUALS))return"equals";if(this.match(d.IS_GREATER_THAN))return"greater_than";if(this.match(d.IS_LESS_THAN))return"less_than";if(this.match(d.STARTS_WITH))return"starts_with";if(this.match(d.ENDS_WITH))return"ends_with";throw new f("Expected comparison operator",this.peek())}parseGroupBy(){let a=this.peek();this.check(d.IDENTIFIER)&&this.peekValue()?.toLowerCase()==="group"?(this.advance(),this.check(d.IDENTIFIER)&&this.peekValue()?.toLowerCase()==="by"&&this.advance()):this.check(d.GROUP_BY)&&this.advance();let b=[];do{let a=this.parseColumn();a&&b.push(a.name)}while(this.match(d.COMMA));return{type:"GroupBy",columns:b,location:this.createLocation(a,this.previous())}}parseOrderBy(){let a=this.peek();this.check(d.IDENTIFIER)&&this.peekValue()?.toLowerCase()==="order"?(this.advance(),this.check(d.IDENTIFIER)&&this.peekValue()?.toLowerCase()==="by"&&this.advance()):this.check(d.ORDER_BY)&&this.advance();let b=[];do{let a=this.parseColumn();if(a){let c="asc";if(this.check(d.IDENTIFIER)){let a=this.peekValue()?.toLowerCase();("asc"===a||"desc"===a)&&(c=a,this.advance())}b.push({column:a.name,direction:c})}}while(this.match(d.COMMA));return{type:"OrderBy",columns:b,location:this.createLocation(a,this.previous())}}parseLimit(){let a=this.previous();if(!this.check(d.NUMBER))throw new f("Expected number after LIMIT",this.peek());return{type:"Limit",value:parseInt(this.advance().value),location:this.createLocation(a,this.previous())}}validateQuery(a){if(a.groupBy){for(let b of a.groupBy.columns)if(!a.select.columns.some(a=>a.name===b)&&0===a.select.aggregates.length)throw new f(`GROUP BY column "${b}" must appear in SELECT clause`)}if(a.orderBy)for(let b of a.orderBy.columns){let c=a.select.columns.some(a=>a.name===b.column),d=a.groupBy?.columns.includes(b.column);if(!c&&!d)throw new f(`ORDER BY column "${b.column}" must appear in SELECT or GROUP BY clause`)}}check(a){return!this.isAtEnd()&&this.peek().type===a}checkAggregate(){return[d.COUNT,d.MIN,d.MAX,d.AVG,d.SUM].includes(this.peek().type)}checkAhead(a,b=1){let c=this.current+b;return!(c>=this.tokens.length)&&this.tokens[c].type===a}match(...a){for(let b of a)if(this.check(b))return this.advance(),!0;return!1}matchSequence(a){for(let b=0;b<a.length;b++)if(!this.checkAhead(a[b],b))return!1;for(let b=0;b<a.length;b++)this.advance();return!0}consume(a,b){if(this.check(a))return this.advance();throw new f(b,this.peek())}advance(){return!this.isAtEnd()&&this.current++,this.previous()}isAtEnd(){return this.peek().type===d.EOF}peek(){return this.tokens[this.current]}peekValue(){return this.tokens[this.current]?.value}previous(){return this.tokens[this.current-1]}checkColumnContinuation(){return![d.FROM,d.WHERE,d.WITH,d.GROUP_BY,d.ORDER_BY,d.LIMIT,d.AND,d.COMMA].includes(this.peek().type)}checkGroupNameContinuation(){return![d.WHERE,d.WITH,d.GROUP_BY,d.ORDER_BY,d.LIMIT].includes(this.peek().type)}checkFilterValueContinuation(){return![d.AND,d.GROUP_BY,d.ORDER_BY,d.LIMIT,d.EOF].includes(this.peek().type)}createLocation(a,b){return{start:a.position,end:b.position+b.value.length,line:a.line,column:a.column}}}let j=new Map([["computer name",{key:"computer_name",type:"text",dbColumn:"computer_name",description:"Endpoint hostname",category:"Core"}],["hostname",{key:"computer_name",type:"text",dbColumn:"computer_name",description:"Endpoint hostname (alias)",category:"Core"}],["computer role",{key:"role",type:"text",dbColumn:"role",description:"Computer role (Workstation, Server, etc.)",category:"Core"}],["role",{key:"role",type:"text",dbColumn:"role",description:"Computer role (alias)",category:"Core"}],["operating system",{key:"os_platform",type:"text",dbColumn:"os_platform",description:"Operating system platform",category:"Core"}],["os platform",{key:"os_platform",type:"text",dbColumn:"os_platform",description:"OS platform (Windows, macOS, Linux)",category:"Core"}],["os version",{key:"os_version",type:"text",dbColumn:"os_version",description:"Operating system version",category:"Core"}],["disk free gb",{key:"disk_free_gb",type:"number",dbColumn:"disk_free_gb",description:"Available disk space in GB",category:"Performance"}],["disk space",{key:"disk_free_gb",type:"number",dbColumn:"disk_free_gb",description:"Available disk space (alias)",category:"Performance"}],["memory gb",{key:"memory_gb",type:"number",dbColumn:"memory_gb",description:"Physical memory in GB",category:"Performance"}],["ram",{key:"memory_gb",type:"number",dbColumn:"memory_gb",description:"RAM in GB (alias)",category:"Performance"}],["cpu percent",{key:"cpu_percent",type:"number",dbColumn:"cpu_percent",description:"CPU utilization percentage",category:"Performance"}],["cpu usage",{key:"cpu_percent",type:"number",dbColumn:"cpu_percent",description:"CPU usage percentage (alias)",category:"Performance"}],["compliance score",{key:"compliance_score",type:"number",dbColumn:"compliance_score",description:"Compliance score (0-1)",category:"Governance"}],["compliance",{key:"compliance_score",type:"number",dbColumn:"compliance_score",description:"Compliance score (alias)",category:"Governance"}],["group",{key:"group_name",type:"text",dbColumn:"group_name",description:"Computer group membership",category:"Metadata"}],["group name",{key:"group_name",type:"text",dbColumn:"group_name",description:"Computer group name",category:"Metadata"}],["location",{key:"location",type:"text",dbColumn:"location",description:"Geographic or network location",category:"Metadata"}],["last reboot",{key:"last_reboot",type:"date",dbColumn:"last_reboot",description:"Last system reboot timestamp",category:"Core"}],["last seen",{key:"last_seen",type:"date",dbColumn:"last_seen",description:"Last time endpoint was seen",category:"Core"}],["ip address",{key:"ip_address",type:"text",dbColumn:"ip_address",description:"Primary IP address",category:"Network"}],["mac address",{key:"mac_address",type:"text",dbColumn:"mac_address",description:"Primary MAC address",category:"Network"}],["serial number",{key:"serial_number",type:"text",dbColumn:"serial_number",description:"Hardware serial number",category:"Asset"}],["manufacturer",{key:"manufacturer",type:"text",dbColumn:"manufacturer",description:"Hardware manufacturer",category:"Asset"}],["model",{key:"model",type:"text",dbColumn:"model",description:"Hardware model",category:"Asset"}]]),k=new Map([["laptops","Laptops"],["servers","Data Center Servers"],["data center servers","Data Center Servers"],["finance","Finance Workstations"],["finance workstations","Finance Workstations"],["canary","Canary Cohort"],["canary cohort","Canary Cohort"],["engineering","Engineering Lab"],["engineering lab","Engineering Lab"],["operations","Operations"],["ops","Operations"],["production","Production Servers"],["prod","Production Servers"],["development","Development Workstations"],["dev","Development Workstations"],["staging","Staging Servers"],["test","Test Environment"]]),l=[{name:"Computer Name",key:"computer_name",category:"Core",type:"text",description:"Returns the endpoint hostname"},{name:"Operating System",key:"os_platform",category:"Core",type:"text",description:"Human-readable OS platform string"},{name:"OS Platform",key:"os_platform",category:"Core",type:"text",description:"Normalized OS platform (Windows, macOS, Linux)"},{name:"OS Version",key:"os_version",category:"Core",type:"text",description:"Version information for the current OS"},{name:"CPU Percent",key:"cpu_percent",category:"Performance",type:"number",description:"Current CPU utilization percentage"},{name:"Memory GB",key:"memory_gb",category:"Performance",type:"number",description:"Physical memory in gigabytes"},{name:"Disk Free GB",key:"disk_free_gb",category:"Performance",type:"number",description:"Available disk capacity in gigabytes"},{name:"Compliance Score",key:"compliance_score",category:"Governance",type:"number",description:"Composite score for patching and configuration compliance"},{name:"Service Status",key:"service_status",category:"Core",type:"text",description:"Status of a given service on the endpoint",parameters:{serviceName:"string"}},{name:"Last Reboot",key:"last_reboot",category:"Core",type:"date",description:"Timestamp of the last reboot"},{name:"Group",key:"group_name",category:"Metadata",type:"text",description:"Logical group membership for the endpoint"},{name:"Location",key:"location",category:"Metadata",type:"text",description:"Geographic or network zone indicator"}],m=["count()","min()","max()","avg()","sum()"];function n(a){return j.get(a.toLowerCase().trim())}function o(a){let b=n(a);return b?.dbColumn}class p{constructor(a=[],b={}){this.data=[],this.warnings=[],this.data=a,this.options={timeout:5e3,maxRows:1e4,useCache:!0,cacheTTL:6e4,explainOnly:!1,format:"json",...b},this.metrics=this.initMetrics()}initMetrics(){return{parseTimeMs:0,planTimeMs:0,executeTimeMs:0,totalTimeMs:0,scoped:0,filtered:0,rowsExamined:0,cacheHit:!1}}async execute(a){let b=performance.now();this.warnings=[],this.metrics=this.initMetrics();try{let c=performance.now(),d=this.generateQueryPlan(a);if(this.metrics.planTimeMs=performance.now()-c,this.options.explainOnly)return this.createExplainResult(d);let e=performance.now(),f=await this.executePlan(a,d);return this.metrics.executeTimeMs=performance.now()-e,this.metrics.totalTimeMs=performance.now()-b,f.execution={...this.metrics},f.warnings=this.warnings,f}catch(a){if(a instanceof g)throw a;throw new g(`Query execution failed: ${a}`)}}generateQueryPlan(a){let b={type:"scan",cost:this.data.length,rows:this.data.length,width:100,children:[]};if("group"===a.from.scope.scopeType&&a.from.scope.value&&b.children?.push({type:"filter",cost:.1*b.rows,rows:Math.floor(.3*b.rows),width:b.width,details:{scope:a.from.scope.value}}),a.where&&a.where.filters.length>0){let c=.5**a.where.filters.length;b.children?.push({type:"filter",cost:.2*b.rows,rows:Math.floor(b.rows*c),width:b.width,details:{filters:a.where.filters.length}})}if(a.groupBy&&a.groupBy.columns.length>0&&b.children?.push({type:"aggregate",cost:.5*b.rows,rows:Math.floor(.1*b.rows),width:50,details:{groupBy:a.groupBy.columns}}),a.orderBy&&a.orderBy.columns.length>0){let c=b.rows*Math.log2(b.rows);b.children?.push({type:"sort",cost:c,rows:b.rows,width:b.width,details:{orderBy:a.orderBy.columns}})}return a.limit&&b.children?.push({type:"limit",cost:1,rows:Math.min(a.limit.value,b.rows),width:b.width,details:{limit:a.limit.value}}),b}async executePlan(a,b){let c=[...this.data];this.metrics.rowsExamined=c.length,c=this.applyScope(c,a),this.metrics.scoped=c.length,a.where?(c=this.applyFilters(c,a.where.filters),this.metrics.filtered=c.length):this.metrics.filtered=this.metrics.scoped;let d=[],e=[];if(a.groupBy||a.select.aggregates.length>0){let b=this.executeAggregates(c,a);d=b.headers,e=b.rows}else{let b=this.executeSelect(c,a);d=b.headers,e=b.rows}a.orderBy&&(e=this.applyOrderBy(e,d,a.orderBy)),a.limit&&(e=e.slice(0,a.limit.value));let f={ok:!0,headers:d,rows:e,rowCount:e.length,metadata:this.buildMetadata(a)};return"csv"===this.options.format&&(f.csv=this.formatAsCSV(d,e)),f}applyScope(a,b){let c=b.from.scope;if("all"===c.scopeType)return a;if("group"===c.scopeType&&c.value){var d;let b=(d=c.value,k.get(d.toLowerCase().trim())||d);return a.filter(a=>a.group_name===b)}return a}applyFilters(a,b){let c=a;for(let a of b){let b=o(a.field);if(!b){this.warnings.push({message:`Unknown field: ${a.field}`,severity:"warning"});continue}!function(a,b){let c=function(a){let b=n(a);return b?.type}(a);return!!c&&!!(["equals","not_equals"].includes(b)||"number"===c&&["greater_than","less_than","greater_or_equal","less_or_equal"].includes(b)||"text"===c&&["contains","does_not_contain","starts_with","ends_with"].includes(b))}(a.field,a.operator)&&this.warnings.push({message:`Operator '${a.operator}' may not be compatible with field '${a.field}'`,severity:"warning"}),c=c.filter(c=>this.evaluateFilter(c,a,b))}return c}evaluateFilter(a,b,c){let d=a[c];if(null==d)return!1;let e=String(d).toLowerCase(),f=String(b.value).toLowerCase();switch(b.operator){case"contains":return e.includes(f);case"does_not_contain":return!e.includes(f);case"equals":return e===f;case"not_equals":return e!==f;case"starts_with":return e.startsWith(f);case"ends_with":return e.endsWith(f);case"greater_than":return Number(d)>Number(b.value);case"less_than":return Number(d)<Number(b.value);case"greater_or_equal":return Number(d)>=Number(b.value);case"less_or_equal":return Number(d)<=Number(b.value);default:return!1}}executeSelect(a,b){let c=b.select.columns,d=c.length>0?c.map(a=>a.name):["Computer Name"],e=a.map(a=>d.map(b=>{let c=o(b);if(!c)return null;let d=a[c];return this.formatValue(d)}));return{headers:d,rows:e}}executeAggregates(a,b){let c=[],d=b.select.aggregates,e=b.groupBy?.columns[0];if(e&&c.push(e),d.length>0?d.forEach(a=>{c.push(`${a.function}(${a.column||""})`)}):c.push("count()"),e){let b=this.groupData(a,e),f=[];for(let[a,c]of b.entries()){let b=[a];d.length>0?d.forEach(a=>{b.push(this.calculateAggregate(c,a))}):b.push(c.length),f.push(b)}return{headers:c,rows:f}}{let b=[];return d.length>0?d.forEach(c=>{b.push(this.calculateAggregate(a,c))}):b.push(a.length),{headers:c,rows:[b]}}}groupData(a,b){let c=new Map,d=o(b);if(!d)return this.warnings.push({message:`Unknown group by column: ${b}`,severity:"error"}),c;for(let b of a){let a=String(b[d]||"null");c.has(a)||c.set(a,[]),c.get(a).push(b)}return c}calculateAggregate(a,b){if("count"===b.function){if(!b.column)return a.length;let c=o(b.column);return c?a.filter(a=>null!=a[c]).length:0}if(!b.column)return null;let c=o(b.column);if(!c)return null;let d=a.map(a=>a[c]).filter(a=>null!=a&&!isNaN(Number(a))).map(Number);if(0===d.length)return null;switch(b.function){case"min":return Math.min(...d);case"max":return Math.max(...d);case"avg":return Math.round(d.reduce((a,b)=>a+b,0)/d.length*100)/100;case"sum":return Math.round(100*d.reduce((a,b)=>a+b,0))/100;default:return null}}applyOrderBy(a,b,c){if(!c)return a;let d=[...a],e=c.columns;return d.sort((a,c)=>{for(let d of e){let e=b.indexOf(d.column);if(-1===e)continue;let f=a[e],g=c[e];if(null===f&&null===g)continue;if(null===f)return"asc"===d.direction?-1:1;if(null===g)return"asc"===d.direction?1:-1;let h=0;if(0!==(h="number"==typeof f&&"number"==typeof g?f-g:String(f).localeCompare(String(g))))return"asc"===d.direction?h:-h}return 0}),d}formatValue(a){return null==a?null:"number"==typeof a?Math.round(1e3*a)/1e3:a instanceof Date?a.toISOString():String(a)}formatAsCSV(a,b){let c=[];for(let d of(c.push(a.map(a=>this.escapeCSV(a)).join(",")),b))c.push(d.map(a=>this.escapeCSV(a)).join(","));return c.join("\n")}escapeCSV(a){if(null==a)return"";let b=String(a);return b.includes(",")||b.includes('"')||b.includes("\n")?`"${b.replace(/"/g,'""')}"`:b}buildMetadata(a){return{aggregations:a.select.aggregates.map(a=>a.function),groupBy:a.groupBy?.columns[0]||null,orderBy:a.orderBy?.columns[0]?.column||null,orderDir:a.orderBy?.columns[0]?.direction||"asc",limit:a.limit?.value||null,scope:a.from.scope.value||a.from.scope.scopeType,filters:a.where?.filters.length||0}}createExplainResult(a){return{ok:!0,headers:["Operation","Cost","Rows","Details"],rows:this.planToRows(a),rowCount:1,metadata:{aggregations:[],groupBy:null,orderBy:null,orderDir:"asc",limit:null,scope:"all",filters:0}}}planToRows(a,b=0){let c=[],d="  ".repeat(b);if(c.push([`${d}${a.type}`,a.cost,a.rows,a.details?JSON.stringify(a.details):null]),a.children)for(let d of a.children)c.push(...this.planToRows(d,b+1));return c}setData(a){this.data=a}getData(){return this.data}}var q=c(55511);class r{constructor(a=1e3,b=3e5){this.accessOrder=[],this.cache=new Map,this.maxSize=a,this.defaultTTL=b,this.stats={hits:0,misses:0,evictions:0,size:0,maxSize:a}}generateKey(a,b){let c="string"==typeof a?a:JSON.stringify(a),d=b?JSON.stringify(b):"";return(0,q.createHash)("sha256").update(c+d).digest("hex").substring(0,16)}get(a,b){let c=this.generateKey(a,b),d=this.cache.get(c);return d?Date.now()>d.timestamp+d.ttl?(this.delete(c),this.stats.misses++,null):(this.updateAccessOrder(c),d.hits++,this.stats.hits++,d.value):(this.stats.misses++,null)}set(a,b,c){let d=this.generateKey(a),e=c?.ttl||this.defaultTTL,f=c?.size||this.estimateSize(b);this.cache.size>=this.maxSize&&this.evictLRU();let g={value:b,timestamp:Date.now(),ttl:e,hits:0,size:f};this.cache.set(d,g),this.updateAccessOrder(d),this.stats.size=this.cache.size}delete(a){let b=this.cache.delete(a);if(b){let b=this.accessOrder.indexOf(a);b>-1&&this.accessOrder.splice(b,1),this.stats.size=this.cache.size}return b}clear(){this.cache.clear(),this.accessOrder=[],this.stats.size=0,this.stats.evictions=0}getStats(){return{...this.stats}}getHitRate(){let a=this.stats.hits+this.stats.misses;return 0===a?0:this.stats.hits/a}evictLRU(){if(0===this.accessOrder.length)return;let a=this.accessOrder[0];this.cache.delete(a),this.accessOrder.shift(),this.stats.evictions++,this.stats.size=this.cache.size}updateAccessOrder(a){let b=this.accessOrder.indexOf(a);b>-1&&this.accessOrder.splice(b,1),this.accessOrder.push(a)}estimateSize(a){return null==a?0:"string"==typeof a?a.length:"number"==typeof a?8:"boolean"==typeof a?1:a instanceof Date?8:Array.isArray(a)?a.reduce((a,b)=>a+this.estimateSize(b),0):"object"==typeof a?Object.entries(a).reduce((a,[b,c])=>a+b.length+this.estimateSize(c),0):0}pruneExpired(){let a=Date.now(),b=0;for(let[c,d]of this.cache.entries())a>d.timestamp+d.ttl&&(this.delete(c),b++);return b}getSizeInBytes(){let a=0;for(let b of this.cache.values())a+=b.size;return a}export(){return JSON.stringify({entries:Array.from(this.cache.entries()),stats:this.stats,accessOrder:this.accessOrder})}import(a){try{let b=JSON.parse(a);this.cache=new Map(b.entries),this.stats=b.stats,this.accessOrder=b.accessOrder||[],this.pruneExpired()}catch(a){console.error("Failed to import cache:",a)}}}class s extends r{constructor(a=500){super(a,36e5)}getAST(a){return this.get(a)}setAST(a,b){this.set(a,b,{size:JSON.stringify(b).length})}}class t extends r{constructor(a=100,b=6e4){super(a,b)}getResult(a,b){return this.get(a,b?{userId:b}:void 0)}setResult(a,b,c){let d=this.estimateResultSize(b);this.set(a,b,{size:d,metadata:c?{userId:c}:void 0})}estimateResultSize(a){let b=100;return a.headers&&(b+=a.headers.join("").length),a.rows&&(b+=50*a.rows.length),a.csv&&(b+=a.csv.length),b}invalidateUser(a){let b=[];for(let[c,d]of this.cache.entries())d.value?.metadata?.userId===a&&b.push(c);b.forEach(a=>this.delete(a))}}class u{constructor(a){this.globalEnabled=!0,this.parsedCache=new s(a?.maxParsedQueries||500),this.resultCache=new t(a?.maxResults||100,a?.resultTTL||6e4),this.globalEnabled=a?.enabled??!0}getParsedQuery(a){return this.globalEnabled?this.parsedCache.getAST(a):null}setParsedQuery(a,b){this.globalEnabled&&this.parsedCache.setAST(a,b)}getQueryResult(a,b){return this.globalEnabled?this.resultCache.getResult(a,b):null}setQueryResult(a,b,c){this.globalEnabled&&(b.cached=!0,this.resultCache.setResult(a,b,c))}clearAll(){this.parsedCache.clear(),this.resultCache.clear()}getStatistics(){let a=this.parsedCache.getStats(),b=this.resultCache.getStats(),c=a.hits+b.hits,d=a.misses+b.misses;return{parsed:a,results:b,totalHitRate:c+d===0?0:c/(c+d)}}pruneExpired(){return{parsed:this.parsedCache.pruneExpired(),results:this.resultCache.pruneExpired()}}setEnabled(a){this.globalEnabled=a,a||this.clearAll()}isEnabled(){return this.globalEnabled}}let v=new u,w=[{computer_name:"LAPTOP-001",role:"Workstation",os_platform:"Windows 11",os_version:"22H2",group_name:"Laptops",location:"NA-US",disk_free_gb:68.2,memory_gb:16,cpu_percent:32.5,compliance_score:.87,last_reboot:"2024-05-18",last_seen:"2024-05-20"},{computer_name:"LAPTOP-002",role:"Workstation",os_platform:"Windows 10",os_version:"21H2",group_name:"Laptops",location:"NA-US",disk_free_gb:45.4,memory_gb:8,cpu_percent:74.3,compliance_score:.62,last_reboot:"2024-05-16",last_seen:"2024-05-19"},{computer_name:"LAPTOP-003",role:"Workstation",os_platform:"Windows 11",os_version:"23H1",group_name:"Finance Workstations",location:"NA-US",disk_free_gb:120.1,memory_gb:16,cpu_percent:18.9,compliance_score:.92,last_reboot:"2024-05-14",last_seen:"2024-05-18"},{computer_name:"SERVER-API-01",role:"Server",os_platform:"Windows Server 2019",os_version:"2019",group_name:"Data Center Servers",location:"NA-US",disk_free_gb:512.4,memory_gb:64,cpu_percent:42.1,compliance_score:.95,last_reboot:"2024-05-12",last_seen:"2024-05-17"},{computer_name:"SERVER-SQL-01",role:"Server",os_platform:"Windows Server 2022",os_version:"2022",group_name:"Data Center Servers",location:"NA-US",disk_free_gb:312.9,memory_gb:128,cpu_percent:55.3,compliance_score:.89,last_reboot:"2024-05-13",last_seen:"2024-05-17"},{computer_name:"SRV-LNX-01",role:"Server",os_platform:"Linux",os_version:"RHEL 9",group_name:"Data Center Servers",location:"EU-DE",disk_free_gb:212.5,memory_gb:32,cpu_percent:21.7,compliance_score:.91,last_reboot:"2024-05-11",last_seen:"2024-05-15"},{computer_name:"MAC-OPS-01",role:"Workstation",os_platform:"macOS",os_version:"14.4",group_name:"Operations",location:"NA-US",disk_free_gb:180.7,memory_gb:32,cpu_percent:23.4,compliance_score:.88,last_reboot:"2024-05-18",last_seen:"2024-05-20"},{computer_name:"MAC-FIN-02",role:"Workstation",os_platform:"macOS",os_version:"13.6",group_name:"Finance Workstations",location:"NA-US",disk_free_gb:102.6,memory_gb:16,cpu_percent:26.1,compliance_score:.93,last_reboot:"2024-05-15",last_seen:"2024-05-18"},{computer_name:"ENG-LAB-01",role:"Workstation",os_platform:"Windows 11",os_version:"22H2",group_name:"Engineering Lab",location:"NA-US",disk_free_gb:250.8,memory_gb:32,cpu_percent:65.2,compliance_score:.77,last_reboot:"2024-05-15",last_seen:"2024-05-18"},{computer_name:"ENG-LAB-02",role:"Workstation",os_platform:"Windows 11",os_version:"22H2",group_name:"Engineering Lab",location:"NA-US",disk_free_gb:198.4,memory_gb:32,cpu_percent:58.4,compliance_score:.75,last_reboot:"2024-05-15",last_seen:"2024-05-18"},{computer_name:"CANARY-EDGE",role:"Workstation",os_platform:"Windows 11",os_version:"23H1",group_name:"Canary Cohort",location:"NA-US",disk_free_gb:156.4,memory_gb:16,cpu_percent:12.4,compliance_score:.98,last_reboot:"2024-05-19",last_seen:"2024-05-20"}];class x{constructor(a){this.savedQueries=new Map,this.templates=new Map,this.parser=new i(a?.parserOptions),this.data=a?.data||w,this.executor=new p(this.data,a?.executorOptions),this.cache=a?.cacheEnabled!==!1?v:new u({enabled:!1}),this.initializeTemplates()}async query(a,b){let c=performance.now();try{if(!a||"string"!=typeof a)throw new e("Question is required and must be a string");let d=this.normalizeQuery(a);if(b?.useCache!==!1){let a=this.cache.getQueryResult(d);if(a)return a.execution={...a.execution,cacheHit:!0,totalTimeMs:performance.now()-c},a}let f=this.cache.getParsedQuery(d);if(!f){let a=performance.now();f=this.parser.parse(d);let b=performance.now()-a;this.cache.setParsedQuery(d,f),f&&(f.parseTimeMs=b)}let g=await this.executor.execute(f);return g.execution={...g.execution,totalTimeMs:performance.now()-c},b?.useCache!==!1&&this.cache.setQueryResult(d,g),g}catch(a){return{ok:!1,error:a instanceof Error?a.message:String(a),errorPosition:a instanceof f?a.position:void 0,execution:{parseTimeMs:0,planTimeMs:0,executeTimeMs:0,totalTimeMs:performance.now()-c,scoped:0,filtered:0,rowsExamined:0,cacheHit:!1}}}}parse(a){let b=this.normalizeQuery(a),c=this.cache.getParsedQuery(b);if(c)return c;let d=this.parser.parse(b);return this.cache.setParsedQuery(b,d),d}async explain(a){let b=this.parse(a);return this.executor.execute(b)}normalizeQuery(a){return a.trim().replace(/\s+/g," ").replace(/^get\s+/i,"Get ")}saveQuery(a,b,c){let d={id:`saved_${Date.now()}`,name:a,question:b,description:c,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString(),executionCount:0};return this.savedQueries.set(a.toLowerCase(),d),d}getSavedQuery(a){return this.savedQueries.get(a.toLowerCase())}listSavedQueries(){return Array.from(this.savedQueries.values())}async runSavedQuery(a){let b=this.getSavedQuery(a);if(!b)throw new e(`No saved query found with name: ${a}`);b.executionCount=(b.executionCount||0)+1,b.lastExecuted=new Date().toISOString();let c=performance.now(),d=await this.query(b.question),f=performance.now()-c;return b.averageTimeMs?b.averageTimeMs=(b.averageTimeMs+f)/2:b.averageTimeMs=f,d}initializeTemplates(){this.addTemplate({id:"all-machines",name:"All Machines",description:"List all machines",template:"Get Computer Name, OS Platform, Group from all machines",parameters:[],category:"Basic",difficulty:1}),this.addTemplate({id:"high-cpu",name:"High CPU Usage",description:"Find machines with high CPU usage",template:'Get Computer Name, CPU Percent from all machines where CPU Percent is greater than "${threshold}" order by CPU Percent desc',parameters:[{name:"threshold",type:"number",required:!0,default:80}],category:"Performance",difficulty:2}),this.addTemplate({id:"low-disk",name:"Low Disk Space",description:"Find machines with low disk space",template:'Get Computer Name, Disk Free GB from all machines where Disk Free GB is less than "${threshold}" order by Disk Free GB',parameters:[{name:"threshold",type:"number",required:!0,default:50}],category:"Performance",difficulty:2}),this.addTemplate({id:"compliance-check",name:"Compliance Check",description:"Check compliance scores by group",template:"Get avg(Compliance Score), min(Compliance Score), count() from all machines group by Group",parameters:[],category:"Governance",difficulty:3})}addTemplate(a){this.templates.set(a.id,a)}getTemplate(a){return this.templates.get(a)}listTemplates(){return Array.from(this.templates.values())}applyTemplate(a,b){let c=this.getTemplate(a);if(!c)throw new e(`Template not found: ${a}`);let d=c.template;for(let a of c.parameters){let c=b[a.name]??a.default;if(a.required&&void 0===c)throw new e(`Required parameter missing: ${a.name}`);d=d.replace(`\${${a.name}}`,String(c))}return d}setData(a){this.data=a,this.executor.setData(a),this.cache.clearAll()}getData(){return this.data}getFieldSuggestions(){return Array.from(j.keys())}getSensorsCatalog(){return l}getAggregateFunctions(){return m}clearCache(){this.cache.clearAll()}getCacheStatistics(){return this.cache.getStatistics()}export(){return JSON.stringify({savedQueries:Array.from(this.savedQueries.entries()),templates:Array.from(this.templates.entries())},null,2)}import(a){try{let b=JSON.parse(a);b.savedQueries&&(this.savedQueries=new Map(b.savedQueries)),b.templates&&(this.templates=new Map(b.templates))}catch(a){throw new e(`Failed to import data: ${a}`)}}}new x},96487:()=>{}};