"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2577],{82577:(e,t,r)=>{r.d(t,{mq:()=>w,Su:()=>y,vt:()=>O});var s=r(95155),o=r(12115),a=r(65380),i=r(66013),n=r(62890),l=r(56189),d=function(e){return e.LEARN="learn",e.PRACTICE="practice",e.ASSESS="assess",e.COMPLETED="completed",e}({}),c=function(e){return e.START_LEARN="start_learn",e.COMPLETE_LEARN="complete_learn",e.START_PRACTICE="start_practice",e.COMPLETE_PRACTICE="complete_practice",e.START_ASSESS="start_assess",e.COMPLETE_ASSESS="complete_assess",e.FAIL_ASSESS="fail_assess",e.RESET_FLOW="reset_flow",e.RESUME_FLOW="resume_flow",e}({});let u={learn:["complete_learn","reset_flow"],practice:["complete_practice","reset_flow"],assess:["complete_assess","fail_assess","reset_flow"],completed:["reset_flow","resume_flow"]},m={learnTopractice:{minSectionsViewed:3,minTimeSpent:600,requireAllCheckpoints:!0},practiceToAssess:{minQuestionsAttempted:5,minAccuracy:.7,minTimeSpent:300,requiredTopics:[]},assessToComplete:{minScore:.8,maxAttempts:3}};class p{canTransition(e){if(!u[this.currentState].includes(e))return!1;switch(e){case c.COMPLETE_LEARN:return this.canProceedToLearn();case c.START_PRACTICE:case c.COMPLETE_PRACTICE:return this.canProceedToPractice();case c.START_ASSESS:case c.COMPLETE_ASSESS:return this.canProceedToAssess();default:return!0}}transition(e){if(!this.canTransition(e))throw Error("Invalid transition: ".concat(e," from state ").concat(this.currentState));let t=this.currentState,r=this.getNextState(e),s=new Date;this.recordEvent(e,{previousState:t,newState:r,timestamp:s.toISOString()});let o={...this.context,currentState:r,timeSpent:this.context.timeSpent+this.calculateSessionTime(),canProceed:this.evaluateCanProceed(r)};switch(e){case c.COMPLETE_LEARN:o.metadata.learnProgress.completedAt=s;break;case c.COMPLETE_PRACTICE:o.metadata.practiceProgress.completedAt=s;break;case c.COMPLETE_ASSESS:o.metadata.assessProgress.completedAt=s,o.completedAt=s;break;case c.FAIL_ASSESS:o.metadata.assessProgress.attempts++,o.metadata.assessProgress.attempts<this.gatingRules.assessToComplete.maxAttempts&&(o.currentState=d.PRACTICE)}return new p(o.currentState,o,this.gatingRules,this.navigationGuard,this.persistence)}canProceedToLearn(){return!0}canProceedToPractice(){let{learnProgress:e}=this.context.metadata,t=this.gatingRules.learnTopractice;if(e.sectionsViewed.length<t.minSectionsViewed||e.timeSpent<t.minTimeSpent)return!1;if(t.requireAllCheckpoints&&e.totalSections>0){let t=e.totalSections;return e.checkpointsPassed.length>=t}return!0}canProceedToAssess(){let{practiceProgress:e}=this.context.metadata,t=this.gatingRules.practiceToAssess;if(e.questionsAttempted<t.minQuestionsAttempted||(e.questionsAttempted>0?e.questionsCorrect/e.questionsAttempted:0)<t.minAccuracy||e.timeSpent<t.minTimeSpent)return!1;if(t.requiredTopics.length>0){let r=e.topics.filter(e=>"proficient"===e.masteryLevel||"advanced"===e.masteryLevel).map(e=>e.topicId);return t.requiredTopics.every(e=>r.includes(e))}return!0}async save(){this.persistence&&await this.persistence.save(this.context)}async resume(){if(this.persistence){let e=await this.persistence.load(this.context.moduleId,this.context.userId);if(e)return this.recordEvent(c.RESUME_FLOW,{resumedAt:new Date().toISOString(),previousState:e.currentState}),new p(e.currentState,e,this.gatingRules,this.navigationGuard,this.persistence)}return this}recordEvent(e,t){let r={event:e,timestamp:new Date,state:this.currentState,metadata:t,duration:this.calculateSessionTime()};this.context.metadata.telemetry.push(r)}getNextState(e){switch(e){case c.START_LEARN:case c.COMPLETE_LEARN:return e===c.COMPLETE_LEARN&&this.canProceedToPractice()?d.PRACTICE:d.LEARN;case c.START_PRACTICE:case c.COMPLETE_PRACTICE:return e===c.COMPLETE_PRACTICE&&this.canProceedToAssess()?d.ASSESS:d.PRACTICE;case c.START_ASSESS:case c.COMPLETE_ASSESS:return e===c.COMPLETE_ASSESS?d.COMPLETED:d.ASSESS;case c.FAIL_ASSESS:return this.context.metadata.assessProgress.attempts<this.gatingRules.assessToComplete.maxAttempts?d.PRACTICE:d.LEARN;case c.RESET_FLOW:return d.LEARN;case c.RESUME_FLOW:default:return this.currentState}}evaluateCanProceed(e){switch(e){case d.LEARN:return!0;case d.PRACTICE:return this.canProceedToPractice();case d.ASSESS:return this.canProceedToAssess();case d.COMPLETED:return!0;default:return!1}}calculateSessionTime(){return Date.now()-this.context.startedAt.getTime()}constructor(e,t,r=m,s,o){this.currentState=e,this.context=t,this.gatingRules=r,this.navigationGuard=s,this.persistence=o}}class S{allowNavigation(e,t,r){if(this.isBackwardNavigation(e,t))return!0;let s=new p(e,r);switch(t){case d.LEARN:return s.canProceedToLearn();case d.PRACTICE:return s.canProceedToPractice();case d.ASSESS:return s.canProceedToAssess();case d.COMPLETED:return!0;default:return!1}}getNavigationWarning(e,t){return this.isBackwardNavigation(e,t)?"Going back will reset your current progress. Are you sure?":null}canForceNavigation(e){return!1}isBackwardNavigation(e,t){let r=[d.LEARN,d.PRACTICE,d.ASSESS,d.COMPLETED];return r.indexOf(e)>r.indexOf(t)}}class E{static createNewFlow(e,t,r){let s=r?{...m,...r}:m,o={moduleId:e,userId:t,currentState:d.LEARN,startedAt:new Date,timeSpent:0,attempts:0,canProceed:!0,metadata:{learnProgress:{sectionsViewed:[],totalSections:0,timeSpent:0,checkpointsPassed:[],keyPointsReviewed:[]},practiceProgress:{questionsAttempted:0,questionsCorrect:0,timeSpent:0,topics:[],hintsUsed:0},assessProgress:{attempts:0,bestScore:0,lastScore:0,timeSpent:0,passed:!1},telemetry:[]}},a=new S;return new p(d.LEARN,o,s,a)}static validateFlowContext(e){let t=[],r=[];return e.moduleId||t.push({code:"MISSING_MODULE_ID",message:"Module ID is required",severity:"error",field:"moduleId"}),e.userId||t.push({code:"MISSING_USER_ID",message:"User ID is required",severity:"error",field:"userId"}),Object.values(d).includes(e.currentState)||t.push({code:"INVALID_STATE",message:"Invalid learning flow state",severity:"error",field:"currentState"}),e.completedAt&&e.completedAt<e.startedAt&&t.push({code:"INVALID_TIMESTAMPS",message:"Completed date cannot be before start date",severity:"error",field:"completedAt"}),e.timeSpent<0&&r.push({code:"NEGATIVE_TIME",message:"Time spent cannot be negative",severity:"warning",field:"timeSpent"}),e.attempts>10&&r.push({code:"HIGH_ATTEMPTS",message:"High number of attempts detected",severity:"warning",field:"attempts"}),{isValid:0===t.length,errors:t,warnings:r}}}class g{async save(e){if(!this.isOnline)return void this.queueForSync(e);try{var t;let{error:r}=await n.N.from("user_study_progress").upsert({user_id:e.userId,module_id:e.moduleId,status:e.currentState,created_at:e.startedAt.toISOString(),completed_at:(null==(t=e.completedAt)?void 0:t.toISOString())||null,time_spent_minutes:e.timeSpent,notes:JSON.stringify({attempts:e.attempts,canProceed:e.canProceed,metadata:e.metadata}),updated_at:new Date().toISOString()}).eq("user_id",e.userId).eq("module_id",e.moduleId);if(r)throw this.queueForSync(e),Error("Failed to save learning flow progress: ".concat(r.message))}catch(t){throw this.queueForSync(e),t}}async load(e,t){if(!this.isOnline)return this.loadFromOfflineQueue(e,t);try{let{data:s,error:o}=await n.N.from("user_study_progress").select("*").eq("user_id",t).eq("module_id",e).single();if(o){var r;if("PGRST116"===o.code||(null==(r=o.details)?void 0:r.includes("0 rows")))return null;throw Error("Failed to load learning flow progress: ".concat(o.message))}if(!s)return null;if(!s)throw Error("No user study progress found.");let a={};if(s.notes)try{a=JSON.parse(s.notes)}catch(e){console.error("Failed to parse learning flow notes:",e)}return{moduleId:s.module_id,userId:s.user_id,currentState:s.status,startedAt:new Date(s.created_at),completedAt:s.completed_at?new Date(s.completed_at):void 0,timeSpent:s.time_spent_minutes||0,attempts:a.attempts||0,canProceed:a.canProceed||!1,metadata:a.metadata||{learnProgress:{sectionsViewed:[],totalSections:0,timeSpent:0,checkpointsPassed:[],keyPointsReviewed:[]},practiceProgress:{questionsAttempted:0,questionsCorrect:0,timeSpent:0,topics:[],hintsUsed:0},assessProgress:{attempts:0,bestScore:0,lastScore:0,timeSpent:0,passed:!1},telemetry:[]}}}catch(e){throw e}}async delete(e,t){if(!this.isOnline){this.offlineQueue=this.offlineQueue.filter(r=>r.moduleId!==e||r.userId!==t);return}try{let{error:r}=await n.N.from("user_study_progress").delete().eq("user_id",t).eq("module_id",e);if(r)throw Error("Failed to delete learning flow progress: ".concat(r.message))}catch(e){throw e}}queueForSync(e){this.offlineQueue=this.offlineQueue.filter(t=>t.moduleId!==e.moduleId||t.userId!==e.userId),this.offlineQueue.push(e);try{localStorage.setItem("learning-flow-offline-queue",JSON.stringify(this.offlineQueue.map(e=>{var t;return{...e,startedAt:e.startedAt.toISOString(),completedAt:null==(t=e.completedAt)?void 0:t.toISOString()}})))}catch(e){}}async syncPendingProgress(){if(!this.isOnline||0===this.offlineQueue.length)return;let e=[...this.offlineQueue];for(let t of(this.offlineQueue=[],e))try{await this.save(t)}catch(e){this.queueForSync(t)}try{localStorage.removeItem("learning-flow-offline-queue")}catch(e){}}loadOfflineQueue(){try{let e=localStorage.getItem("learning-flow-offline-queue");if(e){let t=JSON.parse(e);this.offlineQueue=t.map(e=>({...e,startedAt:new Date(e.startedAt),completedAt:e.completedAt?new Date(e.completedAt):void 0}))}}catch(e){}}handleOnline(){this.isOnline=!0,this.syncPendingProgress().catch(()=>{})}handleOffline(){this.isOnline=!1}loadFromOfflineQueue(e,t){return this.offlineQueue.find(r=>r.moduleId===e&&r.userId===t)||null}constructor(){this.offlineQueue=[],this.isOnline=navigator.onLine,window.addEventListener("online",this.handleOnline.bind(this)),window.addEventListener("offline",this.handleOffline.bind(this))}}let f=new g;f.loadOfflineQueue();let A=[{id:"platform-basics",title:"Platform Basics",description:"Learn the fundamentals of the Tanium platform",domain:"Asking Questions",difficulty:"Beginner",estimatedTime:30,objectives:[{id:"obj-1",description:"Understand platform architecture"},{id:"obj-2",description:"Navigate the console interface"}],sections:[{id:"sec-1",title:"Introduction"},{id:"sec-2",title:"Console Overview"}]},{id:"interact-module",title:"Interact Module",description:"Master the Interact module for querying",domain:"Asking Questions",difficulty:"Beginner",estimatedTime:45,objectives:[{id:"obj-3",description:"Create basic queries"},{id:"obj-4",description:"Use sensor library"}],sections:[{id:"sec-3",title:"Query Basics"},{id:"sec-4",title:"Sensor Library"}]}],h=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"anonymous",t={};return A.forEach(r=>{t[r.id]={moduleId:r.id,userId:e,startedAt:new Date,lastAccessedAt:new Date,totalTimeSpent:0,sectionsCompleted:[],overallProgress:0,quiz_scores:{},currentSection:"",bookmarks:[]}}),t},_=(e,t)=>{switch(t.type){case"SET_CURRENT_MODULE":return{...e,currentModule:t.payload};case"START_MODULE":{var r;let s=t.payload;return new Date().toISOString(),{...e,moduleProgress:{...e.moduleProgress,[s]:{...e.moduleProgress[s],startedAt:(null==(r=e.moduleProgress[s])?void 0:r.startedAt)||new Date,lastAccessedAt:new Date}}}}case"COMPLETE_MODULE":{let r=t.payload;return new Date().toISOString(),e.modules.find(e=>e.id===r),{...e,moduleProgress:{...e.moduleProgress,[r]:{...e.moduleProgress[r],completedAt:new Date,lastAccessedAt:new Date,overallProgress:100}}}}case"UPDATE_PROGRESS":{let{moduleId:r,progress:s}=t.payload;return{...e,moduleProgress:{...e.moduleProgress,[r]:{...e.moduleProgress[r],...s,lastAccessedAt:new Date}}}}case"COMPLETE_OBJECTIVE":{let{moduleId:r,objectiveId:s}=t.payload,o=e.moduleProgress[r]||h()[r];return{...e,moduleProgress:{...e.moduleProgress,[r]:{...o,lastAccessedAt:new Date}}}}case"UNCOMPLETE_OBJECTIVE":{let{moduleId:r,objectiveId:s}=t.payload,o=e.moduleProgress[r]||h()[r];return{...e,moduleProgress:{...e.moduleProgress,[r]:{...o,lastAccessedAt:new Date}}}}case"LOAD_PROGRESS":return{...e,moduleProgress:t.payload};case"RESET_PROGRESS":return{...e,moduleProgress:h("anonymous"),currentModule:null,learningFlows:{}};case"SET_LEARNING_FLOW":return{...e,learningFlows:{...e.learningFlows,[t.payload.moduleId]:t.payload.flow}};case"REMOVE_LEARNING_FLOW":let{[t.payload]:s,...o}=e.learningFlows;return{...e,learningFlows:o};default:return e}},T=(0,o.createContext)(null),P="tco-module-progress";function w(e){let{children:t}=e,{user:r}=(0,a.A)(),[d,c]=(0,o.useReducer)(_,{modules:A,moduleProgress:h((null==r?void 0:r.id)||"anonymous"),currentModule:null,learningFlows:{}}),u=(0,i.t)(),[m,S]=(0,o.useState)(!1),g=(0,o.useRef)(!1);(0,o.useEffect)(()=>{if(g.current)return;let e=()=>{try{let e=localStorage.getItem(P);if(e){let t=JSON.parse(e);c({type:"LOAD_PROGRESS",payload:t})}}catch(e){console.warn("Failed to load module progress from localStorage:",e)}};(async()=>{if(g.current=!0,r&&u)try{let{data:e,error:t}=await n.N.from("user_study_progress").select("*").eq("user_id",r.id);if(t)throw t;let s={};e.forEach(e=>{s[e.module_id]={moduleId:e.module_id,userId:e.user_id||(null==r?void 0:r.id)||"anonymous",startedAt:e.started_at?new Date(e.started_at):new Date,lastAccessedAt:e.last_accessed_at?new Date(e.last_accessed_at):new Date,completedAt:e.completed_at?new Date(e.completed_at):void 0,totalTimeSpent:e.time_spent||0,sectionsCompleted:e.sections_completed||[],overallProgress:e.overall_progress||0,quiz_scores:e.quiz_scores||{},currentSection:e.current_section||"",bookmarks:e.bookmarks||[]}});let o={...h((null==r?void 0:r.id)||"anonymous"),...s};c({type:"LOAD_PROGRESS",payload:o}),S(!0)}catch(t){console.error("Failed to load module progress from database:",t),e()}else e()})()},[]),(0,o.useEffect)(()=>{let e=async()=>{if(m||!r)if(r&&u){for(let[t,s]of Object.entries(d.moduleProgress))if(s.startedAt||s.completedAt)try{var e;let{error:o}=await n.N.from("user_study_progress").upsert({user_id:r.id,module_id:t,time_spent_minutes:s.totalTimeSpent||0,completed_at:(null==(e=s.completedAt)?void 0:e.toISOString())||null,status:s.completedAt?"completed":"in_progress",notes:null,section_id:null}).eq("user_id",r.id).eq("module_id",t);o&&console.error("Failed to save progress for module ".concat(t,":"),o)}catch(e){console.error("Error saving module progress for ".concat(t,":"),e)}}else try{localStorage.setItem(P,JSON.stringify(d.moduleProgress))}catch(e){console.warn("Failed to save module progress to localStorage:",e)}},t=setTimeout(()=>{e()},100);return()=>clearTimeout(t)},[d.moduleProgress,r,u,m]);let w=()=>d.modules.filter(e=>{var t;return null==(t=d.moduleProgress[e.id])?void 0:t.completedAt}),O=()=>d.modules.filter(e=>{let t=d.moduleProgress[e.id];return(null==t?void 0:t.startedAt)&&!t.completedAt}),y=(0,o.useCallback)(async()=>{if(c({type:"RESET_PROGRESS"}),r&&u)try{let{error:e}=await n.N.from("user_study_progress").delete().eq("user_id",r.id);e&&console.error("Failed to reset module progress in database:",e)}catch(e){console.error("Error resetting module progress:",e)}else localStorage.removeItem(P)},[null==r?void 0:r.id,u]),I=(0,o.useCallback)(async e=>{if(!(null==r?void 0:r.id))throw Error("User must be authenticated to start learning flow");let t=d.learningFlows[e];if(t)return t;let s=E.createNewFlow(e,r.id),o=new p(s.currentState,s.context,void 0,void 0,f);return c({type:"SET_LEARNING_FLOW",payload:{moduleId:e,flow:o}}),await o.save(),o},[null==r?void 0:r.id,d.learningFlows]),v=(0,o.useCallback)(async e=>{if(!(null==r?void 0:r.id))return null;let t=d.learningFlows[e];if(t)return t;let s=await f.load(e,r.id);if(s){let t=new p(s.currentState,s,void 0,void 0,f);return c({type:"SET_LEARNING_FLOW",payload:{moduleId:e,flow:t}}),t}return null},[null==r?void 0:r.id,d.learningFlows]),C=(0,o.useCallback)(async(e,t)=>{c({type:"SET_LEARNING_FLOW",payload:{moduleId:e,flow:t}}),await t.save()},[]),R=(0,o.useCallback)(async e=>{(null==r?void 0:r.id)&&(c({type:"REMOVE_LEARNING_FLOW",payload:e}),await f.delete(e,r.id))},[null==r?void 0:r.id]),L={modules:d.modules,moduleProgress:d.moduleProgress,currentModule:d.currentModule,startModule:e=>{c({type:"START_MODULE",payload:e})},completeModule:e=>{c({type:"COMPLETE_MODULE",payload:e})},updateModuleProgress:(e,t)=>{c({type:"UPDATE_PROGRESS",payload:{moduleId:e,progress:t}})},completeObjective:(e,t)=>{c({type:"COMPLETE_OBJECTIVE",payload:{moduleId:e,objectiveId:t}})},uncompleteObjective:(e,t)=>{c({type:"UNCOMPLETE_OBJECTIVE",payload:{moduleId:e,objectiveId:t}})},setCurrentModule:e=>{c({type:"SET_CURRENT_MODULE",payload:e})},getNextModule:e=>{let t=d.modules.findIndex(t=>t.id===e);return t>=0&&t<d.modules.length-1?d.modules[t+1]:null},getPreviousModule:e=>{let t=d.modules.findIndex(t=>t.id===e);return t>0?d.modules[t-1]:null},getModulesByDomain:e=>d.modules.filter(t=>t.domain===e),getModulesByDifficulty:e=>d.modules.filter(t=>t.difficulty===e),getCompletedModules:w,getInProgressModules:O,getNotStartedModules:()=>d.modules.filter(e=>{var t;return!(null==(t=d.moduleProgress[e.id])?void 0:t.startedAt)}),getOverallProgress:()=>{let e=w(),t=O(),r=Object.values(d.moduleProgress).reduce((e,t)=>t&&"number"==typeof t.totalTimeSpent?e+t.totalTimeSpent:e,0),s=d.modules.length>0?e.length/d.modules.length*100:0,o={[l.TCODomain.ASKING_QUESTIONS]:{completed:0,total:0},[l.TCODomain.REFINING_QUESTIONS]:{completed:0,total:0},[l.TCODomain.REFINING_TARGETING]:{completed:0,total:0},[l.TCODomain.TAKING_ACTION]:{completed:0,total:0},[l.TCODomain.NAVIGATION_MODULES]:{completed:0,total:0},[l.TCODomain.REPORTING_EXPORT]:{completed:0,total:0},[l.TCODomain.SECURITY]:{completed:0,total:0},[l.TCODomain.FUNDAMENTALS]:{completed:0,total:0},[l.TCODomain.TROUBLESHOOTING]:{completed:0,total:0}};return d.modules.forEach(e=>{if(!(null==e?void 0:e.domain)||!o[e.domain])return;o[e.domain].total++;let t=d.moduleProgress[e.id];t&&t.completedAt&&o[e.domain].completed++}),{totalModules:d.modules.length,completedModules:e.length,inProgressModules:t.length,totalTimeSpent:r,averageCompletion:s,domainProgress:o}},exportProgress:()=>JSON.stringify({moduleProgress:d.moduleProgress,exportedAt:new Date().toISOString(),version:"1.0"},null,2),importProgress:e=>{try{let t=JSON.parse(e);if(t.moduleProgress&&"object"==typeof t.moduleProgress)return c({type:"LOAD_PROGRESS",payload:t.moduleProgress}),!0;return!1}catch(e){return console.error("Failed to import progress:",e),!1}},resetProgress:y,learningFlows:d.learningFlows,startLearningFlow:I,getLearningFlow:v,updateLearningFlow:C,resetLearningFlow:R};return(0,s.jsx)(T.Provider,{value:L,children:t})}function O(){let e=(0,o.useContext)(T);if(!e)throw Error("useModules must be used within a ModuleProvider");return e}let y=O}}]);