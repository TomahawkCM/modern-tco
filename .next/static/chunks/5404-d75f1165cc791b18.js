"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5404],{62890:(e,t,r)=>{r.d(t,{N:()=>i});var n=r(65040),s=r(95704);let l="https://qnwcwoutgarhqxlgsjzs.supabase.co",o="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InFud2N3b3V0Z2FyaHF4bGdzanpzIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTY2NzM0MjgsImV4cCI6MjA3MjI0OTQyOH0.nooeC4pyNsoRok5zKat9iwUk9rgCfz_b5SWqZ7_dgtQ";if(!l)throw Error("NEXT_PUBLIC_SUPABASE_URL is required. Check your .env.local file.");if(!o)throw Error("NEXT_PUBLIC_SUPABASE_ANON_KEY is required. Check your .env.local file.");let i=(0,n.UU)(l||"",o||"");s.env.SUPABASE_SERVICE_ROLE_KEY&&(0,n.UU)(l||"",s.env.SUPABASE_SERVICE_ROLE_KEY,{auth:{autoRefreshToken:!1,persistSession:!1}})},65380:(e,t,r)=>{r.d(t,{A:()=>i,O:()=>a});var n=r(95155),s=r(62890),l=r(12115);let o=(0,l.createContext)(void 0);function i(){let e=(0,l.useContext)(o);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}function a(e){let{children:t}=e,[r,i]=(0,l.useState)({user:null,session:null,loading:!0,error:null});(0,l.useEffect)(()=>{(async()=>{try{let{data:{session:e},error:t}=await s.N.auth.getSession();if(t){console.error("Error getting initial session:",t),i(e=>({...e,error:t,loading:!1}));return}i(t=>{var r;return{...t,session:e,user:null!=(r=null==e?void 0:e.user)?r:null,loading:!1,error:null}})}catch(e){console.error("Unexpected error getting session:",e),i(t=>({...t,loading:!1,error:e}))}})();let{data:{subscription:e}}=s.N.auth.onAuthStateChange(async(e,t)=>{var r;console.log("Auth state changed:",e,null==t||null==(r=t.user)?void 0:r.id),i(e=>{var r;return{...e,session:t,user:null!=(r=null==t?void 0:t.user)?r:null,loading:!1,error:null}}),"SIGNED_IN"===e&&(null==t?void 0:t.user)||"SIGNED_OUT"===e&&(localStorage.removeItem("tco-progress"),localStorage.removeItem("tco-exam-session"),localStorage.removeItem("tco-incorrect-answers"),localStorage.removeItem("tco-settings"),localStorage.removeItem("tco-search-history"))});return()=>{e.unsubscribe()}},[]);let a=async(e,t)=>{i(e=>({...e,loading:!0,error:null}));try{let{error:r}=await s.N.auth.signInWithPassword({email:e,password:t});return r&&i(e=>({...e,error:r,loading:!1})),{error:r}}catch(e){return i(t=>({...t,error:e,loading:!1})),{error:e}}},u=async(e,t,r)=>{i(e=>({...e,loading:!0,error:null}));try{let{error:n}=await s.N.auth.signUp({email:e,password:t,options:{data:{first_name:(null==r?void 0:r.firstName)||"",last_name:(null==r?void 0:r.lastName)||""}}});return n&&i(e=>({...e,error:n,loading:!1})),{error:n}}catch(e){return i(t=>({...t,error:e,loading:!1})),{error:e}}},d=async()=>{i(e=>({...e,loading:!0,error:null}));try{let{error:e}=await s.N.auth.signOut();return e&&i(t=>({...t,error:e,loading:!1})),{error:e}}catch(e){return i(t=>({...t,error:e,loading:!1})),{error:e}}},c=async e=>{try{let{error:t}=await s.N.auth.resetPasswordForEmail(e,{redirectTo:"".concat(window.location.origin).concat("","/auth/reset-password")});return{error:t}}catch(e){return{error:e}}},_=async e=>{if(!r.user)return{error:{message:"No user logged in"}};try{let{error:t}=await s.N.auth.updateUser({data:{first_name:e.firstName,last_name:e.lastName}});if(t)return{error:t};return{error:null}}catch(e){return{error:e}}},g={...r,signIn:a,signUp:u,signOut:d,resetPassword:c,updateProfile:_};return(0,n.jsx)(o.Provider,{value:g,children:t})}},66013:(e,t,r)=>{r.d(t,{M:()=>o,t:()=>l});var n=r(12115),s=r(62890);function l(e){let t=null==e?void 0:e.id,r=(0,n.useCallback)(async t=>{if(!e)throw Error("User not authenticated");let{data:r,error:n}=await s.N.from("exam_sessions").insert({...t,user_id:e.id}).select().single();if(n)throw n;return null!=r?r:null},[t,e]),l=(0,n.useCallback)(async(t,r)=>{if(!e)throw Error("User not authenticated");let{data:n,error:l}=await s.N.from("exam_sessions").update(r).eq("id",t).eq("user_id",e.id).select().single();if(l)throw l;return null!=n?n:null},[t,e]),o=(0,n.useCallback)(async t=>{if(!e)throw Error("User not authenticated");let{data:r,error:n}=await s.N.from("user_progress").insert({...t,user_id:e.id}).select().single();if(n)throw n;return null!=r?r:null},[t,e]),i=(0,n.useCallback)(async()=>{if(!e)throw Error("User not authenticated");let{data:t,error:r}=await s.N.from("user_statistics").select("*").eq("user_id",e.id);if(r)throw r;return null!=t?t:[]},[t,e]),a=(0,n.useCallback)(async t=>{if(!e)throw Error("User not authenticated");let{data:r,error:n}=await s.N.from("user_statistics").upsert({...t,user_id:e.id}).select().single();if(n)throw n;return null!=r?r:null},[t,e]),u=(0,n.useCallback)(async e=>{let t=s.N.from("questions").select("*");(null==e?void 0:e.category)&&(t=t.eq("category",e.category)),(null==e?void 0:e.difficulty)&&(t=t.eq("difficulty",e.difficulty)),(null==e?void 0:e.tags)&&e.tags.length>0&&(t=t.contains("tags",e.tags)),(null==e?void 0:e.limit)&&(t=t.limit(e.limit));let{data:r,error:n}=await t;if(n)throw n;return null!=r?r:[]},[]);return{insertExamSession:r,updateExamSession:l,insertUserProgress:o,getUserStatistics:i,upsertUserStatistics:a,getQuestions:u,getExamSessions:(0,n.useCallback)(async()=>{if(!e)throw Error("User not authenticated");let{data:t,error:r}=await s.N.from("exam_sessions").select("*").eq("user_id",e.id).order("started_at",{ascending:!1});if(r)throw r;return null!=t?t:[]},[t,e]),getUserProgress:(0,n.useCallback)(async t=>{if(!e)throw Error("User not authenticated");let r=s.N.from("user_progress").select("\n        *,\n        questions (\n          id,\n          question,\n          options,\n          correct_answer,\n          explanation,\n          category,\n          difficulty\n        )\n      ").eq("user_id",e.id).order("completed_at",{ascending:!1});t&&(r=r.eq("exam_session_id",t));let{data:n,error:l}=await r;if(l)throw l;return null!=n?n:[]},[t,e]),getModuleProgress:async function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];if(!e)throw Error("User not authenticated");let r=s.N.from("user_module_progress").select("*").eq("user_id",e.id);t.length>0&&(r=r.in("module_id",t));let{data:n,error:l}=await r;if(l)throw l;return null!=n?n:[]},getStudyNeedsReviewMap:async function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];if(!e)throw Error("User not authenticated");let r=s.N.from("user_study_progress").select("module_id,status").eq("user_id",e.id).eq("status","needs_review");t.length>0&&(r=r.in("module_id",t));let{data:n,error:l}=await r;if(l)throw l;let o={};for(let e of n||[]){let t=e.module_id;o[t]=(o[t]||0)+1}return o},getLastViewedSectionsMap:async function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];if(!e)throw Error("User not authenticated");let r=s.N.from("user_study_progress").select("module_id,section_id,updated_at").eq("user_id",e.id).order("updated_at",{ascending:!1});t.length>0&&(r=r.in("module_id",t));let{data:n,error:l}=await r;if(l)throw l;let o={};for(let e of n||[]){let t=e.module_id,r=e.section_id;r&&!o[t]&&(o[t]=r)}return o},getUserStudyProgress:async t=>{if(!e)throw Error("User not authenticated");let r=s.N.from("user_study_progress").select("*").eq("user_id",e.id).order("updated_at",{ascending:!1});t&&(r=r.eq("module_id",t));let{data:n,error:l}=await r;if(l)throw l;return null!=n?n:[]},upsertUserStudyProgress:async t=>{var r,n,l;if(!e)throw Error("User not authenticated");let o={user_id:e.id,module_id:t.module_id,section_id:null!=(r=t.section_id)?r:null,status:t.status,time_spent_minutes:null!=(n=t.time_spent_minutes)?n:0,notes:null!=(l=t.notes)?l:null,completed_at:"completed"===t.status?new Date().toISOString():null,created_at:new Date().toISOString(),updated_at:new Date().toISOString()},{data:i,error:a}=await s.N.from("user_study_progress").insert(o).select().single();if(a)throw a;return null!=i?i:null},upsertModuleProgress:async t=>{var r,n,l;if(!e)throw Error("User not authenticated");let{data:o,error:i}=await s.N.from("user_module_progress").upsert({user_id:e.id,module_id:t.module_id,completed_sections:null!=(r=t.completed_sections)?r:null,total_sections:null!=(n=t.total_sections)?n:null,status:null!=(l=t.status)?l:null,last_updated:new Date().toISOString()}).select().single();if(i)throw i;return null!=o?o:null}}}function o(e,t,r){let[l,o]=(0,n.useState)([]),[i,a]=(0,n.useState)(!0),[u,d]=(0,n.useState)(null);return(0,n.useEffect)(()=>{let n;return(async()=>{try{let l=s.N.from(e).select("*");if(t){let[e,r,n]=t.split(/[=.]/);"eq"===r&&(l=l.eq(e,n))}let{data:i,error:a}=await l;a?d(a.message):o(i||[]),n=s.N.channel("".concat(e,"_changes")).on("postgres_changes",{event:"*",schema:"public",table:e,filter:t},e=>{r&&r(e),o(t=>{switch(e.eventType){case"INSERT":return[...t,e.new];case"UPDATE":return t.map(t=>t.id===e.new.id?e.new:t);case"DELETE":return t.filter(t=>t.id!==e.old.id);default:return t}})}).subscribe()}catch(e){d(e instanceof Error?e.message:"Unknown error")}finally{a(!1)}})(),()=>{n&&n.unsubscribe()}},[e,t,r]),{data:l,loading:i,error:u}}}}]);