"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[103],{103:(t,e,i)=>{i.d(e,{questionService:()=>s});var a=i(56189),o=i(62890);class n{mapChoiceIdToDb(t){let e=(t||"").toString().toLowerCase(),i={a:0,b:1,c:2,d:3};if(e in i)return i[e];let a=Number(e);return Number.isFinite(a)?a:e}mapDbDifficultyToUi(t){switch((t||"").toLowerCase()){case"beginner":return a.Difficulty.BEGINNER;case"intermediate":return a.Difficulty.INTERMEDIATE;case"advanced":return a.Difficulty.ADVANCED;case"expert":return a.Difficulty.EXPERT;default:if(t===a.Difficulty.BEGINNER||t===a.Difficulty.INTERMEDIATE||t===a.Difficulty.ADVANCED||t===a.Difficulty.EXPERT)return t;return a.Difficulty.INTERMEDIATE}}mapUiDifficultyToDb(t){switch((t||"").toString()){case a.Difficulty.BEGINNER:case"beginner":return"beginner";case a.Difficulty.INTERMEDIATE:case"intermediate":return"intermediate";case a.Difficulty.ADVANCED:case"advanced":return"advanced";case a.Difficulty.EXPERT:case"expert":return"expert";default:return"intermediate"}}mapDbDomainToUi(t){if(!t)return a.TCODomain.FUNDAMENTALS;let e=t.toUpperCase();return this.DOMAIN_DB_TO_UI[e]?this.DOMAIN_DB_TO_UI[e]:Object.values(a.TCODomain).find(e=>e===t)||a.TCODomain.FUNDAMENTALS}mapUiDomainToDb(t){if(Object.values(a.TCODomain).includes(t))return t;let e=t||a.TCODomain.FUNDAMENTALS;return this.DOMAIN_UI_TO_DB[e]||a.TCODomain.FUNDAMENTALS}mapDbCategoryToUi(t){if(!t)return a.QuestionCategory.PLATFORM_FUNDAMENTALS;let e=t.toUpperCase();return this.CATEGORY_DB_TO_UI[e]?this.CATEGORY_DB_TO_UI[e]:Object.values(a.QuestionCategory).find(e=>e===t)||a.QuestionCategory.PLATFORM_FUNDAMENTALS}mapUiCategoryToDb(t){let e=t||a.QuestionCategory.PLATFORM_FUNDAMENTALS;return this.CATEGORY_UI_TO_DB[e]||"PLATFORM_FUNDAMENTALS"}async getAllQuestions(){let{data:t,error:e}=await o.N.from("questions").select("*").order("created_at");if(e)throw Error("Failed to fetch questions: ".concat(e.message));return this.transformDatabaseQuestions(null!=t?t:[])}async getQuestionsByDomain(t){let e=this.mapUiDomainToDb(t),{data:i,error:a}=await o.N.from("questions").select("*").eq("domain",e).order("created_at");if(a)throw Error("Failed to fetch questions for domain ".concat(t,": ").concat(a.message));return this.transformDatabaseQuestions(null!=i?i:[])}async getQuestionsByDifficulty(t){let e=this.mapUiDifficultyToDb(t),{data:i,error:a}=await o.N.from("questions").select("*").eq("difficulty",e).order("created_at");if(a)throw Error("Failed to fetch questions for difficulty ".concat(t,": ").concat(a.message));return this.transformDatabaseQuestions(null!=i?i:[])}async getQuestionsByCategory(t){let e=this.mapUiCategoryToDb(t),{data:i,error:a}=await o.N.from("questions").select("*").eq("category",e).order("created_at");if(a)throw Error("Failed to fetch questions for category ".concat(t,": ").concat(a.message));return this.transformDatabaseQuestions(null!=i?i:[])}async getWeightedRandomQuestions(t){let{data:e,error:i}=await o.N.rpc("get_weighted_random_questions",{question_count:t});if(i)throw Error("Failed to fetch weighted random questions: ".concat(i.message));return(null!=e?e:[]).map(t=>t.question_data)}async getMockExamQuestions(){return this.getWeightedRandomQuestions(105)}async getRandomQuestions(t){let{data:e,error:i}=await o.N.from("questions").select("*").order("RANDOM()").limit(t);if(i)throw Error("Failed to fetch random questions: ".concat(i.message));return this.transformDatabaseQuestions(null!=e?e:[])}async getPracticeQuestions(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10,i=this.mapUiDomainToDb(t),{data:a,error:n}=await o.N.from("questions").select("*").eq("domain",i).order("RANDOM()").limit(e);if(n)throw Error("Failed to fetch practice questions: ".concat(n.message));return this.transformDatabaseQuestions(null!=a?a:[])}async getQuestionStats(){var t,e,i,n;let s=await o.N.from("questions").select("*",{count:"exact",head:!0}),r=null!=(t=null==s?void 0:s.count)?t:0,c=await o.N.from("questions").select("domain"),u=null!=(e=null==c?void 0:c.data)?e:[],l=null==c?void 0:c.error;if(l)throw Error("Failed to fetch domain statistics: ".concat(l.message));let T=await o.N.from("questions").select("difficulty"),N=null!=(i=null==T?void 0:T.data)?i:[],d=await o.N.from("questions").select("category"),D=null!=(n=null==d?void 0:d.data)?n:[],O={},f={},E={};return Object.values(a.TCODomain).forEach(t=>{O[t]=0}),Object.values(a.Difficulty).forEach(t=>{f[t]=0}),Object.values(a.QuestionCategory).forEach(t=>{E[t]=0}),u.forEach(t=>{let e=this.mapDbDomainToUi(t.domain||void 0);O[e]=(O[e]||0)+1}),N.forEach(t=>{let e=this.mapDbDifficultyToUi(t.difficulty);f[e]=(f[e]||0)+1}),D.forEach(t=>{let e=this.mapDbCategoryToUi(t.category);E[e]=(E[e]||0)+1}),{totalQuestions:r||0,domainDistribution:O,difficultyDistribution:f,categoryDistribution:E}}async searchQuestions(t){let{data:e,error:i}=await o.N.from("questions").select("*").or("question.ilike.%".concat(t,"%,explanation.ilike.%").concat(t,"%")).order("created_at");if(i)throw Error("Failed to search questions: ".concat(i.message));return this.transformDatabaseQuestions(null!=e?e:[])}async getQuestionsByTags(t){let{data:e,error:i}=await o.N.from("questions").select("*").overlaps("tags",t).order("created_at");if(i)throw Error("Failed to fetch questions by tags: ".concat(i.message));return this.transformDatabaseQuestions(null!=e?e:[])}async validateQuestionDatabase(){let t=[],e=[];try{var i,n;let s=await o.N.from("questions").select("id, question, options, correct_answer").or("question.is.null,options.is.null,correct_answer.is.null"),r=null!=(i=null==s?void 0:s.data)?i:[];r.length>0&&t.push("Found ".concat(r.length," questions with missing required fields"));let c=await o.N.from("questions").select("id, options, correct_answer");(null!=(n=null==c?void 0:c.data)?n:[]).forEach(e=>{if(e.options&&Array.isArray(e.options)){var i;let a=e.options.map((t,e)=>t&&"object"==typeof t&&"id"in t?String(t.id):["a","b","c","d"][e]||String(e)),o=(i=e.correct_answer,"number"==typeof i?["a","b","c","d"][i]||String(i):"string"==typeof i?({0:"a",1:"b",2:"c",3:"d"})[i]||i:String(null!=i?i:"a"));a.includes(o)||t.push("Question ".concat(e.id,": Correct answer ID '").concat(e.correct_answer,"' not found in choices"))}else t.push("Question ".concat(e.id,": Choices are missing or not an array."))});let u=await this.getQuestionStats(),l={[a.TCODomain.ASKING_QUESTIONS]:22,[a.TCODomain.REFINING_QUESTIONS]:23,[a.TCODomain.TAKING_ACTION]:15,[a.TCODomain.NAVIGATION_MODULES]:23,[a.TCODomain.REPORTING_EXPORT]:17};Object.entries(l).forEach(t=>{let[i,a]=t,o=u.domainDistribution[i]/u.totalQuestions*100;Math.abs(o-a)>5&&e.push("Domain ".concat(i,": Expected ~").concat(a,"%, got ").concat(o.toFixed(1),"%"))})}catch(e){t.push("Database validation failed: ".concat(e))}return{isValid:0===t.length,errors:t,warnings:e}}transformDatabaseQuestions(t){return(Array.isArray(t)?t:t?[t]:[]).map(t=>{let e,i=t.correct_answer;return e="number"==typeof i?["a","b","c","d"][i]||String(i):"string"==typeof i?({0:"a",1:"b",2:"c",3:"d"})[i]||i:String(null!=i?i:"a"),{id:t.id,question:t.question,choices:t.options||[],correctAnswerId:e,domain:this.mapDbDomainToUi(t.domain),difficulty:this.mapDbDifficultyToUi(t.difficulty),category:this.mapDbCategoryToUi(t.category),explanation:t.explanation||"",tags:t.tags||[],studyGuideRef:t.study_guide_ref||t.references||"",createdAt:t.created_at?new Date(t.created_at):void 0,updatedAt:t.updated_at?new Date(t.updated_at):void 0}})}async addQuestion(t){var e,i;let a={question:t.question,options:t.choices,correct_answer:this.mapChoiceIdToDb(t.correctAnswerId),domain:this.mapUiDomainToDb(t.domain),difficulty:this.mapUiDifficultyToDb(t.difficulty),category:this.mapUiCategoryToDb(t.category),explanation:t.explanation||null,tags:t.tags||[],created_at:(null==(e=t.createdAt)?void 0:e.toISOString())||new Date().toISOString(),updated_at:(null==(i=t.updatedAt)?void 0:i.toISOString())||new Date().toISOString()},{data:n,error:s}=await o.N.from("questions").insert(a).select().single();if(s)throw Error("Failed to add question: ".concat(s.message));return this.transformDatabaseQuestions(n)[0]}async updateQuestion(t,e){let i={...e.question&&{question:e.question},...e.choices&&{options:e.choices},...e.correctAnswerId&&{correct_answer:this.mapChoiceIdToDb(e.correctAnswerId)},...e.domain&&{domain:this.mapUiDomainToDb(e.domain)},...e.difficulty&&{difficulty:this.mapUiDifficultyToDb(e.difficulty)},...e.category&&{category:this.mapUiCategoryToDb(e.category)},...e.explanation&&{explanation:e.explanation},...e.tags&&{tags:e.tags},...e.createdAt&&{created_at:e.createdAt.toISOString()},updated_at:new Date().toISOString()},{data:a,error:n}=await o.N.from("questions").update(i).eq("id",t).select().single();if(n)throw Error("Failed to update question: ".concat(n.message));return this.transformDatabaseQuestions(a)[0]}async deleteQuestion(t){let{error:e}=await o.N.from("questions").delete().eq("id",t);if(e)throw Error("Failed to delete question: ".concat(e.message))}constructor(){this.DOMAIN_DB_TO_UI={ASKING_QUESTIONS:a.TCODomain.ASKING_QUESTIONS,REFINING_QUESTIONS:a.TCODomain.REFINING_QUESTIONS,REFINING_TARGETING:a.TCODomain.REFINING_TARGETING,TAKING_ACTION:a.TCODomain.TAKING_ACTION,NAVIGATION_MODULES:a.TCODomain.NAVIGATION_MODULES,NAVIGATION_BASIC_MODULE_FUNCTIONS:a.TCODomain.NAVIGATION_MODULES,REPORTING_EXPORT:a.TCODomain.REPORTING_EXPORT,REPORTING_DATA_EXPORT:a.TCODomain.REPORTING_EXPORT,SECURITY:a.TCODomain.SECURITY,FUNDAMENTALS:a.TCODomain.FUNDAMENTALS,TROUBLESHOOTING:a.TCODomain.TROUBLESHOOTING},this.DOMAIN_UI_TO_DB={[a.TCODomain.ASKING_QUESTIONS]:"ASKING_QUESTIONS",[a.TCODomain.REFINING_QUESTIONS]:"REFINING_QUESTIONS",[a.TCODomain.REFINING_TARGETING]:"REFINING_TARGETING",[a.TCODomain.TAKING_ACTION]:"TAKING_ACTION",[a.TCODomain.NAVIGATION_MODULES]:"NAVIGATION_MODULES",[a.TCODomain.REPORTING_EXPORT]:"REPORTING_EXPORT",[a.TCODomain.SECURITY]:"SECURITY",[a.TCODomain.FUNDAMENTALS]:"FUNDAMENTALS",[a.TCODomain.TROUBLESHOOTING]:"TROUBLESHOOTING"},this.CATEGORY_DB_TO_UI={PLATFORM_FUNDAMENTALS:a.QuestionCategory.PLATFORM_FUNDAMENTALS,CONSOLE_PROCEDURES:a.QuestionCategory.CONSOLE_PROCEDURES,TROUBLESHOOTING:a.QuestionCategory.TROUBLESHOOTING,PRACTICAL_SCENARIOS:a.QuestionCategory.PRACTICAL_SCENARIOS,LINEAR_CHAIN:a.QuestionCategory.LINEAR_CHAIN},this.CATEGORY_UI_TO_DB={[a.QuestionCategory.PLATFORM_FUNDAMENTALS]:"PLATFORM_FUNDAMENTALS",[a.QuestionCategory.CONSOLE_PROCEDURES]:"CONSOLE_PROCEDURES",[a.QuestionCategory.TROUBLESHOOTING]:"TROUBLESHOOTING",[a.QuestionCategory.PRACTICAL_SCENARIOS]:"PRACTICAL_SCENARIOS",[a.QuestionCategory.LINEAR_CHAIN]:"LINEAR_CHAIN"}}}let s=new n}}]);