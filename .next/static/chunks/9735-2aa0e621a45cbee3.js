"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9735],{19735:(e,t,r)=>{r.d(t,{d:()=>N,T:()=>p});var n=r(95155),o=r(62890);let i=null,a=0;function s(e){let t="string"==typeof e.options?JSON.parse(e.options):e.options,r="string"==typeof e.tags?JSON.parse(e.tags):e.tags||[];return{id:e.id,question:e.question,choices:t,correctAnswerId:e.correct_answer,domain:e.domain,difficulty:e.difficulty,category:e.category,explanation:e.explanation||"",tags:r,studyGuideRef:e.study_guide_ref||void 0,createdAt:e.created_at?new Date(e.created_at):void 0,updatedAt:e.updated_at?new Date(e.updated_at):void 0}}async function l(){var e,t,r,n;let l=arguments.length>0&&void 0!==arguments[0]&&arguments[0],c=Date.now();if(!l&&i&&c-a<3e5)return i;try{let{data:r,error:n}=await o.N.from("questions").select("*").order("created_at",{ascending:!1});if(n){if("PGRST116"===n.code||(null==(e=n.message)?void 0:e.includes('relation "public.questions" does not exist'))||(null==(t=n.message)?void 0:t.includes("table 'public.questions' in the schema")))return console.log("Database table not found, using fallback data"),[];if(console.error("Unexpected error fetching questions:",n.message),i)return i;return[]}if(!r||0===r.length)return console.warn("No questions found in database"),[];let l=r.map(e=>s(e));return i=l,a=c,l}catch(e){if(e&&("PGRST116"===e.code||(null==(r=e.message)?void 0:r.includes('relation "public.questions" does not exist'))||(null==(n=e.message)?void 0:n.includes("table 'public.questions' in the schema"))))return[];if(console.error("Unexpected error fetching questions:",e.message),i)return i;return[]}}async function c(e){try{let{data:t,error:r}=await o.N.from("questions").select("*").eq("domain",e).order("created_at",{ascending:!1});if(r)throw console.error("Error fetching questions for domain ".concat(e,":"),r),r;return(null!=t?t:[]).map(e=>s(e))}catch(t){return console.error("Failed to fetch questions for domain ".concat(e,":"),t),[]}}async function u(e){try{let{data:t,error:r}=await o.N.from("questions").select("*").eq("difficulty",e).order("created_at",{ascending:!1});if(r)throw console.error("Error fetching questions for difficulty ".concat(e,":"),r),r;return(null!=t?t:[]).map(e=>s(e))}catch(t){return console.error("Failed to fetch questions for difficulty ".concat(e,":"),t),[]}}async function d(e){try{let{data:t,error:r}=await o.N.from("questions").select("*").eq("category",e).order("created_at",{ascending:!1});if(r)throw console.error("Error fetching questions for category ".concat(e,":"),r),r;return(null!=t?t:[]).map(e=>s(e))}catch(t){return console.error("Failed to fetch questions for category ".concat(e,":"),t),[]}}async function f(e){try{let{data:t,error:r}=await o.N.from("questions").select("*").or("question.ilike.%".concat(e,"%,explanation.ilike.%").concat(e,"%")).order("created_at",{ascending:!1});if(r)throw console.error('Error searching questions for "'.concat(e,'":'),r),r;return(null!=t?t:[]).map(e=>s(e))}catch(t){return console.error('Failed to search questions for "'.concat(e,'":'),t),[]}}async function g(e){try{let t=o.N.from("questions").select("*");e.domains&&e.domains.length>0&&(t=t.in("domain",e.domains)),e.difficulties&&e.difficulties.length>0&&(t=t.in("difficulty",e.difficulties)),e.categories&&e.categories.length>0&&(t=t.in("category",e.categories)),e.tags&&e.tags.length,e.limit&&(t=t.limit(e.limit)),t=t.order("created_at",{ascending:!1});let{data:r,error:n}=await t;if(n)throw console.error("Error fetching filtered questions:",n),n;let i=(r||[]).map(s);return e.tags&&e.tags.length>0&&(i=i.filter(t=>t.tags&&e.tags.some(e=>t.tags.includes(e)))),i}catch(e){return console.error("Failed to fetch filtered questions:",e),[]}}function h(){i=null,a=0}async function m(){try{let e=await l();if(e.length>0)return console.log("Loaded ".concat(e.length," questions from Supabase")),e;let{importedQuestionBank:t}=await r.e(1454).then(r.bind(r,91454));return console.log("Falling back to imported question bank: ".concat(t.length," questions")),t}catch(o){var e,t;o&&("PGRST116"===o.code||(null==(e=o.message)?void 0:e.includes('relation "public.questions" does not exist'))||(null==(t=o.message)?void 0:t.includes("table 'public.questions' in the schema")))||console.error("Unexpected error loading questions:",o.message);let{importedQuestionBank:n}=await r.e(1454).then(r.bind(r,91454));return console.log("Emergency fallback to imported question bank: ".concat(n.length," questions")),n}}var y=r(56189),q=r(71985),b=r(12115),C=r(20063);let E=(0,b.createContext)(null);function N(e){let{children:t}=e,[i,a]=(0,b.useState)([]),[s,N]=(0,b.useState)(!0),[p,w]=(0,b.useState)(null),T=(0,C.usePathname)(),A=b.useMemo(()=>{let e=(T||"").toLowerCase();return["/admin","/study","/learn","/learning","/modules","/assessments","/kb"].some(t=>e.startsWith(t))},[T]),_=(0,b.useCallback)(async()=>{N(!0),w(null);try{let e=await m();a(e)}catch(e){console.error("Failed to load questions:",e),w("Failed to load questions. Please try again.");try{let{questionBank:e}=await r.e(687).then(r.bind(r,80687));a(e)}catch(e){a([])}}finally{N(!1)}},[]);(0,b.useEffect)(()=>{var e;if(!A)return void N(!1);let t=null;return _(),e=e=>{console.log("Questions updated:",e),_()},t=o.N.channel("questions_changes").on("postgres_changes",{event:"*",schema:"public",table:"questions"},t=>{h(),e(t)}).subscribe(),()=>{try{null==t||t.unsubscribe()}catch(e){}}},[_,A]);let I=(0,b.useCallback)(async function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];N(!0),w(null);try{e&&h();let t=await l(e);a(t)}catch(e){console.error("Failed to refresh questions:",e),w("Failed to refresh questions.")}finally{N(!1)}},[]),O=(0,b.useCallback)(async e=>{try{return await c(e)}catch(t){return console.error("Failed to fetch questions for domain ".concat(e,":"),t),i.filter(t=>t.domain===e)}},[i]),D=(0,b.useCallback)(async e=>{try{return await u(e)}catch(t){return console.error("Failed to fetch questions for difficulty ".concat(e,":"),t),i.filter(t=>t.difficulty===e)}},[i]),v=(0,b.useCallback)(async e=>{try{return await d(e)}catch(t){return console.error("Failed to fetch questions for category ".concat(e,":"),t),i.filter(t=>t.category===e)}},[i]),k=(0,b.useCallback)(async e=>{try{return await g(e)}catch(r){console.error("Failed to fetch filtered questions:",r);let t=[...i];return e.domains&&e.domains.length>0&&(t=t.filter(t=>e.domains.includes(t.domain))),e.difficulties&&e.difficulties.length>0&&(t=t.filter(t=>e.difficulties.includes(t.difficulty))),e.categories&&e.categories.length>0&&(t=t.filter(t=>e.categories.includes(t.category))),e.tags&&e.tags.length>0&&(t=t.filter(t=>t.tags&&e.tags.some(e=>t.tags.includes(e)))),e.limit&&(t=t.slice(0,e.limit)),t}},[i]),F=(0,b.useCallback)(async e=>{try{return await f(e)}catch(r){console.error('Failed to search questions for "'.concat(e,'":'),r);let t=e.toLowerCase();return i.filter(e=>{var r;return e.question.toLowerCase().includes(t)||(null==(r=e.explanation)?void 0:r.toLowerCase().includes(t))})}},[i]),S=(0,b.useCallback)((e,t)=>{if(!i||!Array.isArray(i)||0===i.length)return[];let r=[...i];t&&(t.domains&&t.domains.length>0&&(r=r.filter(e=>t.domains.includes(e.domain))),t.difficulties&&t.difficulties.length>0&&(r=r.filter(e=>t.difficulties.includes(e.difficulty))),t.categories&&t.categories.length>0&&(r=r.filter(e=>t.categories.includes(e.category))));let n=r.sort(()=>Math.random()-.5);return n.slice(0,Math.min(e,n.length))},[i]),R=(0,b.useCallback)(async e=>{try{let t=[...i];switch(e.domainFilter&&(t=t.filter(t=>t.domain===e.domainFilter)),e.moduleId&&(t=t.filter(t=>{var r,n;return(null==(r=t.tags)?void 0:r.includes(e.moduleId))||(null==(n=t.tags)?void 0:n.includes("module-".concat(e.moduleId)))})),e.type){case"practice":default:t=t.sort(()=>Math.random()-.5);break;case"mock_exam":let r=[y.Difficulty.BEGINNER,y.Difficulty.INTERMEDIATE,y.Difficulty.ADVANCED],n=Math.ceil(e.count/r.length),o=[];r.forEach(e=>{let r=t.filter(t=>t.difficulty===e).sort(()=>Math.random()-.5).slice(0,n);o=o.concat(r)}),t=o.sort(()=>Math.random()-.5);break;case"final_exam":t=t.filter(e=>e.difficulty===y.Difficulty.INTERMEDIATE||e.difficulty===y.Difficulty.ADVANCED).sort(()=>Math.random()-.5)}return t.slice(0,e.count)}catch(t){return console.error("Failed to get assessment questions:",t),S(e.count,e.domainFilter?{domains:[e.domainFilter]}:void 0)}},[i,S]),M=(0,b.useCallback)(e=>i.find(t=>t.id===e),[i]),x=b.useMemo(()=>{let e={[y.TCODomain.ASKING_QUESTIONS]:0,[y.TCODomain.REFINING_QUESTIONS]:0,[y.TCODomain.REFINING_TARGETING]:0,[y.TCODomain.TAKING_ACTION]:0,[y.TCODomain.NAVIGATION_MODULES]:0,[y.TCODomain.REPORTING_EXPORT]:0,[y.TCODomain.SECURITY]:0,[y.TCODomain.FUNDAMENTALS]:0,[y.TCODomain.TROUBLESHOOTING]:0};return i&&Array.isArray(i)&&i.forEach(t=>{t.domain in e&&e[t.domain]++}),e},[i]),G=b.useMemo(()=>{let e=(0,q.I_)(()=>0);return i&&Array.isArray(i)&&i.forEach(t=>{t.difficulty in e&&e[t.difficulty]++}),e},[i]),L=b.useMemo(()=>{let e={[y.QuestionCategory.PLATFORM_FUNDAMENTALS]:0,[y.QuestionCategory.CONSOLE_PROCEDURES]:0,[y.QuestionCategory.TROUBLESHOOTING]:0,[y.QuestionCategory.PRACTICAL_SCENARIOS]:0,[y.QuestionCategory.LINEAR_CHAIN]:0};return i&&Array.isArray(i)&&i.forEach(t=>{t.category in e&&e[t.category]++}),e},[i]),P={questions:i,loading:s,error:p,totalQuestions:i?i.length:0,refreshQuestions:I,getQuestionsByDomain:O,getQuestionsByDifficulty:D,getQuestionsByCategory:v,getQuestionsWithFilters:k,searchQuestionsByText:F,getAssessmentQuestions:R,getRandomQuestions:S,getQuestionById:M,domainDistribution:x,difficultyDistribution:G,categoryDistribution:L};return(0,n.jsx)(E.Provider,{value:P,children:t})}function p(){let e=(0,b.useContext)(E);if(!e)throw Error("useQuestions must be used within a QuestionsProvider");return e}}}]);